{"version":3,"file":"static/js/553.98d255cf.chunk.js","mappings":"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","sources":["components/auth/SignOut.js","libs/Auth.js","libs/TrackPromise.js"],"sourcesContent":["import React from \"react\";\nimport { useEffect, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\nimport { signOut } from \"../../libs/TrackPromise\";\nimport { AuthContext } from \"../../providers/AuthProvider\";\nimport { OnlineStatusContext } from \"../../providers/OnlineStatusProvider\";\nimport { toast } from \"../Toast\";\nimport { ETBTAdd } from \"../../libs/I18n\"; // TODO: remove me when finished collecting serve errors\n\n\n\nfunction SignOut() {\n  const history = useHistory();\n  const isOnline = useContext(OnlineStatusContext);\n  const { auth, setAuth } = useContext(AuthContext);\n  const { t } = useTranslation();\n\n  // use `useEffect` to avoid  \"cannot update a component while rendering a different component\" error\n  useEffect(() => {\n    if (!isOnline) { // fake signout while offline...\n      // TODO: we should also at least clear localStorage.CognitoIdentityServiceProvider.* keys ...\n      //return toast.warning(\"You are currently offline. Please wait for the network to become available.\");\n      setAuth({ user: false })\n      history.replace(\"/\");\n    } else {\n      signOut({\n        success: () => {\n          //toast.success(t(\"Signed out\")); // too noisy...\n          setAuth({ user: false })\n          history.replace(\"/\");\n        },\n        error: (err) => {\nconsole.error(\"signOut error:\", err);\nETBTAdd(\"signOut\", err);\n          toast.error(t(err.message));\n        }\n      });\n    }\n  }, [isOnline, history, auth, setAuth, t]);\n\n  return null;\n};\n\nexport default React.memo(SignOut);\n","import config from \"../config\";\nimport { currentFunctionName } from \"../libs/Misc\";\n\nconst Auth_ = {\n  signIn: (params) => {\nconsole.log(currentFunctionName(), params);\n    return fetcher(\"/api/auth/login\", \"POST\", params);\n  },\n  signUp: (params) => {\nconsole.log(currentFunctionName(), params);\n    return fetcher(\"/api/auth/register\", \"POST\", params);\n  },\n  confirmSignUp: (params) => {\nconsole.log(currentFunctionName(), params);\n    // TODO: props = props.filter(key => key === \"code\");\n    return fetcher(`/api/auth/verify/${params.code}`, \"GET\", params); // TODO: choose: verify or confirmSignUp, and code or token (better code) ...\n  },\n  currentAuthenticatedUser: (params) => {\nconsole.log(currentFunctionName(), params);\n    return new Promise((resolve, reject) => {\n      const auth = JSON.parse(localStorage.getItem('auth'));\nconsole.log(currentFunctionName(), \"auth:\", auth);\n      if (auth) {\nconsole.log(currentFunctionName(), \"resolving auth.user:\", auth.user);\n        resolve(auth.user);\n      } else {\nconsole.log(currentFunctionName(), \"rejecting\");\n        reject();\n      }\n    });\n  },\n  signOut: (params) => {\nconsole.log(currentFunctionName());\n    // nothing to do\n    return new Promise((resolve, reject) => {\n      resolve();\n    });\n  },\n};\n\nconst fetcher = (url, method, params) => {\nconsole.log(\"fetcher:\", url, method, params);\n  return new Promise((resolve, reject) => {\n    if (method === \"GET\" && params) {\n      url += \"?\" + Object.keys(params).map((key) => {\n        return encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key])\n      }).join(\"&\");\n    }\nconsole.log(\"fetcher url 2:\", url);\nvar opt = {\n  method,\n  headers: new Headers(config.api.headers),\n  ...(params && method !== \"GET\" && { body: JSON.stringify(params) }),\n  redirect: config.api.redirect,\n}\nconsole.log(\"fetcher opt:\", opt);\n    fetch(url, {\n      method,\n      headers: new Headers(config.api.headers),\n      ...(params && method !== \"GET\" && { body: JSON.stringify(params) }),\n      //body: new URLSearchParams(params),\n      redirect: config.api.redirect,\n    })\n      .then(res => {\nconsole.log(\"fetcher res:\", res);\n        try {\n          res.json().then(data => {\nconsole.log(\"fetcher data:\", data);\n            if (!res.ok) reject({status: res.status, statusText: res.statusText, message: data.message ? data.message : res.statusText})\n            resolve(data);\n          });\n        } catch (err) {\n          console.error(\"fetch error:\", err); // TODO: !!!\n        }\n\n      })\n      .catch(err => reject(err))\n    ;\n  });\n}\n\nexport default Auth_;","//import React from \"react\";\n//import { Auth } from \"aws-amplify\";\nimport { trackPromise } from \"react-promise-tracker\";\nimport Auth_ from \"./Auth\";\n\n\n\nexport function currentAuthenticatedUser({success, error, final}) {\n  trackPromise(\n    Auth_.currentAuthenticatedUser()\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n}\n\nexport function signIn(props, {success, error, final}) {\n  trackPromise(\n    Auth_.signIn({...props})\n      .then((data) => {console.log(\"success:\", data); success(data)})\n      .catch((data) => {console.log(\"error:\", data); error(data)})\n      .finally((data) => final(data))\n  );\n}\n\nexport function federatedSignIn(props, {success, error, final}) {\n  trackPromise(\n    Auth_.federatedSignIn({...props})\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n}\n  \nexport function signUp(props, {success, error, final}) {\n  trackPromise(\n    Auth_.signUp({...props})\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\n//export function confirmSignUp(username, code, {success, error, final}) {\nexport function confirmSignUp(props, {success, error, final}) {\nconsole.log('TrackPromise - props:', props);\n  trackPromise(\n    Auth_.confirmSignUp({...props})\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function forgotPassword(username, {success, error, final}) {\n  trackPromise(\n    Auth_.forgotPassword(username)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function resendSignUp(username, {success, error, final}) {\n  trackPromise(\n    Auth_.resendSignUp(username)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function forgotPasswordSubmit(username, code, password, {success, error, final}) {\n  trackPromise(\n    Auth_.forgotPasswordSubmit(username, code, password,)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function resendResetPasswordCode(username, {success, error, final}) {\n  trackPromise(\n    //Auth.resendResetPassword(username)\n    Auth_.resendSignUp(username)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function signOut({success, error, final}) {\n  trackPromise(\n    Auth_.signOut()\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n"],"names":["SignOut","history","useHistory","isOnline","useContext","OnlineStatusContext","AuthContext","auth","setAuth","t","useTranslation","useEffect","signOut","success","user","replace","error","err","console","ETBTAdd","toast","message","React","Auth_","signIn","params","log","currentFunctionName","fetcher","signUp","confirmSignUp","code","currentAuthenticatedUser","Promise","resolve","reject","JSON","parse","localStorage","getItem","url","method","Object","keys","map","key","encodeURIComponent","join","opt","headers","Headers","config","body","stringify","redirect","fetch","then","res","json","data","ok","status","statusText","catch","props","final","trackPromise","finally","federatedSignIn","forgotPassword","username","resendSignUp","forgotPasswordSubmit","password","resendResetPasswordCode"],"sourceRoot":""}