{"version":3,"file":"static/js/553.c97cb521.chunk.js","mappings":"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","sources":["components/auth/SignOut.js","libs/Auth.js","libs/TrackPromise.js"],"sourcesContent":["import React from \"react\";\nimport { useEffect, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\nimport { signOut } from \"../../libs/TrackPromise\";\nimport { AuthContext } from \"../../providers/AuthProvider\";\nimport { OnlineStatusContext } from \"../../providers/OnlineStatusProvider\";\nimport { toast } from \"../Toast\";\nimport { ETBTAdd } from \"../../libs/I18n\"; // TODO: remove me when finished collecting serve errors\n\n\n\nfunction SignOut() {\n  const history = useHistory();\n  const isOnline = useContext(OnlineStatusContext);\n  const { auth, setAuth } = useContext(AuthContext);\n  const { t } = useTranslation();\n\n  // use `useEffect` to avoid  \"cannot update a component while rendering a different component\" error\n  useEffect(() => {\n    if (!isOnline) { // fake signout while offline...\n      // TODO: we should also at least clear localStorage.CognitoIdentityServiceProvider.* keys ...\n      //return toast.warning(\"You are currently offline. Please wait for the network to become available.\");\nconsole.log(\"signOut calling setAuth\");\n      setAuth({ user: false })\n      history.replace(\"/\");\n    } else {\n      signOut({\n        success: () => {\n          //toast.success(t(\"Signed out\")); // too noisy...\nconsole.log(\"signOut calling setAuth\");\n          setAuth({ user: false })\n          history.replace(\"/\");\n        },\n        error: (err) => {\nconsole.error(\"signOut error:\", err);\nETBTAdd(\"signOut\", err);\n          toast.error(t(err.message));\n        }\n      });\n    }\n  }, [isOnline, history, auth, setAuth, t]);\n\n  return null;\n};\n\nexport default React.memo(SignOut);\n","import  { Redirect } from \"react-router-dom\";\nimport config from \"../config\";\nimport { currentFunctionName } from \"../libs/Misc\";\n\nconst Auth = {\n  signUp: (params) => {\n    //console.log(currentFunctionName(), params);\n    return fetcher(\"/api/auth/register\", \"POST\", params);\n  },\n  confirmSignUp: (params) => {\n    //console.log(currentFunctionName(), params);\n    // TODO: props = props.filter(key => key === \"code\");\n    return fetcher(`/api/auth/verify/${params.code}`, \"GET\", params); // TODO: change the name: choose verify or confirmSignUp, and code or token (better code) ...\n  },\n  signIn: (params) => {\n    //console.log(currentFuncionName(), params);\n    return fetcher(\"/api/auth/login\", \"POST\", params);\n  },\n  federatedSignIn: (params) => {\nconsole.log(\"*********************\", currentFunctionName(), params);\n    //return fetcher(\"/api/auth/loginGoogle\", \"GET\", params); // TODO: use the federated login based on params\n    return <Redirect to=\"/api/auth/loginGoogle\" />\n  },\n  currentAuthenticatedUser: (params) => {\n    //console.log(currentFunctionName(), params);\n    return new Promise((resolve, reject) => {\n      const auth = JSON.parse(localStorage.getItem('auth'));\n\n      // TODO: https://www.bezkoder.com/jwt-refresh-token-node-js/ (for server side refresh token handling)\n      // TODO:\n/*\n      function isAuthenticated() {\n        const accessToken = localStorage.getItem('accessToken');\n        const refreshToken = localStorage.getItem('refreshToken');\n        try {\n          decode(accessToken);\n          const { exp } = decode(refreshToken);\n          if (Date.now() >= exp * 1000) {\n            return false;\n          }\n        } catch (err) {\n          return false;\n        }\n        return true;\n      }\n*/\n\n      //console.log(currentFunctionName(), \"auth:\", auth);\n      if (auth) {\n        //console.log(currentFunctionName(), \"resolving auth.user:\", auth.user);\n        resolve(auth.user);\n      } else {\n        //console.log(currentFunctionName(), \"rejecting\");\n        reject();\n      }\n    });\n  },\n  signOut: (params) => {\n    //console.log(currentFunctionName());\n    // nothing to do\n    return new Promise((resolve, reject) => {\n      resolve();\n    });\n  },\n};\n\nconst fetcher = (url, method, params) => {\nconsole.log(\"fetcher:\", url, method, params);\n  return new Promise((resolve, reject) => {\n    if (method === \"GET\" && params) {\n      url += \"?\" + Object.keys(params).map((key) => {\n        return encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key])\n      }).join(\"&\");\n    }\nconsole.log(\"fetcher url 2:\", url);\nvar opt = {\n  method,\n  headers: new Headers(config.api.headers),\n  ...(params && method !== \"GET\" && { body: JSON.stringify(params) }),\n  redirect: config.api.redirect,\n}\nconsole.log(\"fetcher opt:\", opt);\n    fetch(url, {\n      method,\n      headers: new Headers(config.api.headers),\n      ...(params && method !== \"GET\" && { body: JSON.stringify(params) }),\n      //body: new URLSearchParams(params),\n      redirect: config.api.redirect,\n    })\n      .then(res => {\nconsole.log(\"fetcher res:\", res);\n        try {\n          res.json().then(data => {\nconsole.log(`fetcher from ${url} data:`, data);\n            if (!res.ok) reject({status: res.status, statusText: res.statusText, message: data.message ? data.message : res.statusText})\n            resolve(data);\n          });\n        } catch (err) {\n          console.error(`fetch ${url} error:`, err); // TODO: !!!\n        }\n\n      })\n      .catch(err => {\n        console.error(`fetch ${url} error:`, err); // TODO: !!!\n        reject(err)\n      })\n    ;\n  });\n}\n\nexport default Auth;","//import React from \"react\";\n//import { Auth } from \"aws-amplify\";\nimport { trackPromise } from \"react-promise-tracker\";\nimport Auth from \"./Auth\";\n\n\n\nexport function currentAuthenticatedUser({success, error, final}) {\n  trackPromise(\n    Auth.currentAuthenticatedUser()\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n}\n\nexport function signIn(props, {success, error, final}) {\n  trackPromise(\n    Auth.signIn({...props})\n      .then((data) => {console.log(\"success:\", data); success(data)})\n      .catch((data) => {console.log(\"error:\", data); error(data)})\n      .finally((data) => final(data))\n  );\n}\n\nexport function federatedSignIn(props, {success, error, final}) {\n  //trackPromise(\n    Auth.federatedSignIn({...props})\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  //);\n}\n  \nexport function signUp(props, {success, error, final}) {\n  trackPromise(\n    Auth.signUp({...props})\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\n//export function confirmSignUp(username, code, {success, error, final}) {\nexport function confirmSignUp(props, {success, error, final}) {\nconsole.log('TrackPromise - props:', props);\n  trackPromise(\n    Auth.confirmSignUp({...props})\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function forgotPassword(username, {success, error, final}) {\n  trackPromise(\n    Auth.forgotPassword(username)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function resendSignUp(username, {success, error, final}) {\n  trackPromise(\n    Auth.resendSignUp(username)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function forgotPasswordSubmit(username, code, password, {success, error, final}) {\n  trackPromise(\n    Auth.forgotPasswordSubmit(username, code, password,)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function resendResetPasswordCode(username, {success, error, final}) {\n  trackPromise(\n    //Auth.resendResetPassword(username)\n    Auth.resendSignUp(username)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function signOut({success, error, final}) {\n  trackPromise(\n    Auth.signOut()\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n"],"names":["SignOut","history","useHistory","isOnline","useContext","OnlineStatusContext","AuthContext","auth","setAuth","t","useTranslation","useEffect","signOut","success","console","log","user","replace","error","err","ETBTAdd","toast","message","React","Auth","signUp","params","fetcher","confirmSignUp","code","signIn","federatedSignIn","currentFunctionName","to","currentAuthenticatedUser","Promise","resolve","reject","JSON","parse","localStorage","getItem","url","method","Object","keys","map","key","encodeURIComponent","join","opt","headers","Headers","config","body","stringify","redirect","fetch","then","res","json","data","ok","status","statusText","catch","props","final","trackPromise","finally","forgotPassword","username","resendSignUp","forgotPasswordSubmit","password","resendResetPasswordCode"],"sourceRoot":""}