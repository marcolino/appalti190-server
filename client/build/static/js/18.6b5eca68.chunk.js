(this["webpackJsonpappalti190-client"]=this["webpackJsonpappalti190-client"]||[]).push([[18],{324:function(e,t,r){"use strict";var n=r(31),a={getProfile:function(){return n.a.get("/user/getProfile").then((function(e){return e.data}),(function(e){return e}))},updateProfile:function(e){var t=e.email,r=e.password,a=e.firstName,o=e.lastName,i=e.address,l=e.fiscalCode,s=e.businessName;return n.a.post("/user/updateProfile",{email:t,password:r,firstName:a,lastName:o,address:i,fiscalCode:l,businessName:s}).then((function(e){return e.data}),(function(e){return e}))},updateUserProperty:function(e){var t=e.userId,r=e.propertyName,a=e.propertyValue;return n.a.post("/user/updateUserProperty",{userId:t,propertyName:r,propertyValue:a}).then((function(e){return e.data}),(function(e){return e}))},getAllPlans:function(e){return n.a.get("/user/getAllPlans").then((function(e){return e.data}),(function(e){return e}))},updatePlan:function(e){return console.log("updatePlan - plan:",e),n.a.post("/user/updatePlan",e).then((function(e){return e.data}),(function(e){return e}))},getAllRoles:function(e){return n.a.get("/user/getAllRoles").then((function(e){return e.data}),(function(e){return e}))},updateRoles:function(e){return n.a.post("/user/updateRoles",e).then((function(e){return e.data}),(function(e){return e}))},getPublicContent:function(){return n.a.get("/test/all")},getUserBoard:function(){return n.a.get("/test/user")},getModeratorBoard:function(){return n.a.get("/test/mod")},getAdminBoard:function(){return n.a.get("/test/admin")},getAllUsersWithFullInfo:function(){return n.a.get("/user/getAllUsersWithFullInfo").then((function(e){return e.data}),(function(e){return e}))}};t.a=a},453:function(e,t,r){"use strict";r.r(t);var n=r(106),a=r(14),o=r(21),i=r(312),l=r(89),s=r.n(l),c=r(0),u=r.n(c),d=r(18),f=r(296),b=r(338),p=r(287),m=r(299),j=r(303),h=r(462),g=r(473),O=r(298),x=r(419),C=r(292),P=r(302),N=r(367),v=r(456),y=r(301),S=r(475),w=r(454),E=r(455),W=r(480),R=r(459),k=r(136),D=r.n(k),A=r(414),U=r.n(A),F=r(323),I=r.n(F),G=r(40),M=r(76),V=r(324),z=r(45),L=r(57),B=r(77),T=r(1),H=["children","value","index"],J=Object(p.a)((function(e){return function(e){return{root:{flexGrow:1},datagrid:{"&.MuiDataGrid-root .MuiDataGrid-columnHeader:focus, &.MuiDataGrid-root .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-cell:focus-within, & .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-columnHeaderCheckbox:focus-within, & .MuiDataGrid-columnHeaderCheckbox:focus":{outline:"none"},"& .adminpanel-table--row":{borderRadius:1,backgroundColor:e.palette.tertiary.light,outline:"none"}},avatar:{backgroundColor:e.palette.success.main},columnLeft:{marginLeft:e.spacing(.2)},columnRight:{marginLeft:"auto",marginRight:e.spacing(.2)},form:{},fieldset:{border:0},fieldsetPersonalData:{color:"#758c75",fontSize:13,border:1,borderStyle:"solid",borderColor:"#758c75",borderRadius:5},fieldsetCompanyData:{color:"#7a7aa5",fontSize:13,border:1,borderStyle:"solid",borderColor:"#7a7aa5",borderRadius:5},fieldsetAddress:{color:"#aaa",fontSize:13,border:1,borderStyle:"solid",borderColor:"#aaa",borderRadius:5},title:{width:"100%",color:e.palette.title.color,display:"flex",justifyContent:"center",paddingTop:3,paddingBottom:50,paddingLeft:10,paddingRight:10},formControlSelectPlan:{minWidth:200},formControlSelectRole:{minWidth:200},tab:{backgroundColor:e.palette.secondary.light},tabIndicator:{backgroundColor:e.palette.secondary.dark,height:1}}}(e)}));function q(e){var t=e.children,r=e.value,n=e.index,a=Object(i.a)(e,H);return Object(T.jsx)(O.a,Object(o.a)(Object(o.a)({component:"div",role:"tabpanel",hidden:r!==n,id:"scrollable-auto-tabpanel-".concat(n),"aria-labelledby":"nav-tab-".concat(n)},a),{},{children:Object(T.jsx)(N.a,{p:3,children:t})}))}function Z(e){var t,r=J(),i=Object(d.f)(),l=Object(c.useState)(z.a.getUser()),u=Object(a.a)(l,1)[0],p=Object(c.useState)([]),O=Object(a.a)(p,2),k=O[0],A=O[1],F=Object(c.useState)(!1),H=Object(a.a)(F,2),Z=H[0],_=H[1],K=Object(c.useState)(10),Q=Object(a.a)(K,2),X=Q[0],Y=Q[1],$=Object(c.useState)([5,10,20,50,100]),ee=Object(a.a)($,1)[0],te=Object(c.useState)(0),re=Object(a.a)(te,2),ne=re[0],ae=re[1],oe=Object(c.useState)(!1),ie=Object(a.a)(oe,2)[1],le=Object(f.a)().t,se=Object(c.useState)(e.tabValue),ce=Object(a.a)(se,2),ue=ce[0],de=ce[1],fe=Object(c.useState)(!1),be=Object(a.a)(fe,1)[0],pe=Object(c.useState)(Object(L.a)(G.a)),me=Object(a.a)(pe,1)[0],je=Object(c.useState)((function(){switch(me){case"it":return w.a.components.MuiDataGrid.defaultProps.localeText;case"fr":return E.a.components.MuiDataGrid.defaultProps.localeText;default:return null}})),he=Object(a.a)(je,1)[0],ge=[{field:"actions",headerName:le("Actions"),type:"actions",width:90,getActions:function(e){return[Object(T.jsx)(W.a,{label:le("Delete"),icon:Object(T.jsx)(U.a,{}),onClick:function(e){console.log("DELETE",e)}}),Object(T.jsx)(W.a,{label:le("Force logout"),icon:Object(T.jsx)(I.a,{}),onClick:function(e){console.log("FORCE LOGOUT",e)}})]}},{field:"firstName",headerName:le("First Name"),minWidth:100,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("firstName",e)}},{field:"lastName",headerName:le("Last Name"),minWidth:120,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("lastName",e)}},{field:"email",headerName:le("Email"),minWidth:240,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("email",e)}},{field:"businessName",headerName:le("Business name"),minWidth:150,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("businessName",e)}},{field:"fiscalCode",headerName:le("Fiscal code"),minWidth:180,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("fiscalCode",e)}},{field:"roles",headerName:le("Role"),minWidth:170,flex:1,editable:!0,type:"singleSelect",valueOptions:["user","admin"]},{field:"plan",headerName:le("Plan"),minWidth:150,flex:1,editable:!0,type:"singleSelect",valueOptions:[le("free"),le("standard"),le("unlimited")]},{field:"addressStreet",headerName:le("Street"),minWidth:180,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("addressStreet",e)}},{field:"address.streetNo",headerName:le("N\xb0"),minWidth:50,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("address.streetNo",e)},renderCell:function(e){return e.row["address.streetNo"]}},{field:"address.city",headerName:le("City"),minWidth:90,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("address.city",e)},renderCell:function(e){return e.row["address.city"]}},{field:"address.zip",headerName:le("ZIP"),minWidth:70,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("address.zip",e)},renderCell:function(e){return e.row["address.zip"]}},{field:"address.province",headerName:le("Pr."),minWidth:50,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("address.province",e)},renderCell:function(e){return e.row["address.province"]}},{field:"address.country",headerName:le("Country"),minWidth:80,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("address.country",e)},renderCell:function(e){return e.row["address.country"]}}],Oe=function(){var e=Object(n.a)(s.a.mark((function e(t,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("*** preProcessEditCellValidation property, params:",t,r),e.abrupt("return",new Promise((function(e,n){return V.a.updateUserProperty({userId:r.id,propertyName:t,propertyValue:r.props.value}).then((function(t){t instanceof Error?(B.b.dismiss(),B.b.warn(Object(M.g)(t)),n(Object(o.a)(Object(o.a)({},r.props),{},{error:!0}))):(console.log("*** preProcessEditCellValidation result:",t),r.props.value=t.propertyValue,e(Object(o.a)(Object(o.a)({},r.props),{},{error:!1})))}))})));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){null!==u&&void 0!==u&&u.id||(B.b.error(le("User must be authenticated")),i.goBack())}),[null===u||void 0===u?void 0:u.id,i,le]),Object(b.a)((function(e){be&&e.preventDefault()})),Object(c.useEffect)((function(){var e=i.block((function(e,t){return!be||window.confirm(le("Are you sure to ignore unsaved data?"))}));return function(){e()}}),[be,i,le]),Object(c.useEffect)((function(){V.a.getAllUsersWithFullInfo().then((function(e){if(e instanceof Error)return console.error("getAllUsersWithFullInfo error:",e),ie({code:e.message});console.log("getAllUsersWithFullInfo got successfully:",e.users),e.users=e.users.map((function(e){return Object(o.a)(Object(o.a)({},Object(M.h)(e,"address")),{},{id:e._id,plan:e.plan.name,roles:e.roles[0].name})})),console.log("getAllUsersWithFullInfo got successfully after flattening:",e.users),A(e.users),_(!0)}))}),[null===u||void 0===u?void 0:u.id,ie,le]),console.log("USERS:",k),Object(T.jsx)("div",{className:r.root,children:Object(T.jsxs)(P.a,{children:[" ",Object(T.jsx)(N.a,{m:1}),Object(T.jsx)(C.a,{container:!0,justifyContent:"center",children:Object(T.jsx)(x.a,{className:r.avatar,children:Object(T.jsx)(D.a,{})})}),Object(T.jsx)(N.a,{m:3}),Object(T.jsx)(m.a,{elevation:0,position:"static",children:Object(T.jsx)(j.a,{elevation:1,square:!0,children:Object(T.jsx)(h.a,{value:ue,onChange:function(e,t){de(t)},variant:"standard","aria-label":"tabs administrator's panel",classes:{indicator:r.tabIndicator},className:r.tab,children:Object(T.jsx)(g.a,Object(o.a)({label:le("Users")},(t=0,{id:"simple-tab-".concat(t),"aria-controls":"simple-tabpanel-".concat(t)})))})})}),Object(T.jsxs)(q,{value:ue,index:0,children:[Object(T.jsx)(N.a,{m:3}),Object(T.jsx)(R.a,{rows:k,columns:ge,localeText:he,autoHeight:!0,pageSize:X,onPageSizeChange:function(e){return Y(e)},rowsPerPageOptions:ee,pagination:!0,checkboxSelection:!0,disableSelectionOnClick:!0,className:r.datagrid,getRowClassName:function(){return"adminpanel-table--row"},onCellEditCommit:function(e){B.b.success(le("Field updated"))},onSelectionChange:function(e){!function(e){console.warn(e.rows+" selected users")}(e)},onRowSelected:function(e){return console.warn(e.api.current.getSlectedRows()+" selected users")},onSelectionModelChange:function(e){var t=new Set(e);ae(k.filter((function(e){return t.has(e.id.toString())})).length)},rowHeight:40,components:{NoRowsOverlay:function(){return Object(T.jsx)(v.a,{height:"100%",alignItems:"center",justifyContent:"center",children:Z?le("No users found"):le("Loading")+"..."})}},experimentalFeatures:{preventCommitWhileValidating:!0}}),Object(T.jsx)(N.a,{m:3}),ne>0&&Object(T.jsxs)("div",{children:[Object(T.jsx)(S.a,{title:le("Delete all selected users"),placement:"top",children:Object(T.jsx)(y.a,{"aria-label":"delete all selected users",onClick:function(){return alert("delete all selected...")},children:Object(T.jsx)(U.a,{})})}),Object(T.jsx)(S.a,{title:le("Force logout for all selected users"),placement:"top",children:Object(T.jsx)(y.a,{"aria-label":"force logout for all selected users",onClick:function(){return alert("logout all selected...")},children:Object(T.jsx)(I.a,{})})})]})]})]})})}Z.defaultProps={tabValue:0},t.default=u.a.memo(Z)}}]);
//# sourceMappingURL=18.6b5eca68.chunk.js.map