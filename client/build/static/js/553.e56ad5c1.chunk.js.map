{"version":3,"file":"static/js/553.e56ad5c1.chunk.js","mappings":"0MAWA,SAASA,IACP,IAAMC,GAAUC,EAAAA,EAAAA,MACVC,GAAWC,EAAAA,EAAAA,YAAWC,EAAAA,GAC5B,GAA0BD,EAAAA,EAAAA,YAAWE,EAAAA,GAA7BC,EAAR,EAAQA,KAAMC,EAAd,EAAcA,QACNC,GAAMC,EAAAA,EAAAA,KAAND,EA4BR,OAzBAE,EAAAA,EAAAA,YAAU,WACHR,GAOHS,EAAAA,EAAAA,IAAQ,CACNC,QAAS,WAEjBC,QAAQC,IAAI,2BACZD,QAAQC,IAAI,gBAAiBR,GACnBC,EAAQ,CAAEQ,MAAM,IAC1BF,QAAQC,IAAI,gBAAiBR,GACnBN,EAAQgB,QAAQ,MAElBC,MAAO,SAACC,GAChBL,QAAQI,MAAM,iBAAkBC,GACtBC,EAAAA,EAAAA,MAAYX,EAAEU,EAAIE,cAf5BP,QAAQC,IAAI,2BACNP,EAAQ,CAAEQ,MAAM,IAChBf,EAAQgB,QAAQ,QAiBjB,CAACd,EAAUF,EAASM,EAAMC,EAASC,IAE/B,KAGT,UAAea,EAAAA,KAAWtB,I,yKC1CpBuB,EAAO,CACXC,OAAQ,SAACC,GAEP,OAAOC,EAAQ,qBAAsB,OAAQD,IAE/CE,cAAe,SAACF,GAGd,OAAOC,EAAQ,oBAAD,OAAqBD,EAAOG,MAAQ,MAAOH,IAE3DI,OAAQ,SAACJ,GAEP,OAAOC,EAAQ,kBAAmB,OAAQD,IAS5CK,+BAAgC,SAACL,GAK/B,OAAO,IAAIM,SAAQ,SAACC,EAASC,GAC3B,IAAM1B,EAAO2B,KAAKC,MAAMC,aAAaC,QAAQ,SAC7CvB,QAAQC,IAAI,iCAAkCR,GAC9CyB,IAAQzB,GAAOA,EAAKS,UAgCxBJ,QAAS,SAACa,GAGR,OAAO,IAAIM,SAAQ,SAACC,EAASC,GAC3BD,SAKAN,EAAU,SAACY,EAAKC,EAAQd,GAE5B,OADFX,QAAQC,IAAI,WAAYuB,EAAKC,EAAQd,GAC5B,IAAIM,SAAQ,SAACC,EAASC,GACZ,QAAXM,GAAoBd,IACtBa,GAAO,IAAME,OAAOC,KAAKhB,GAAQiB,KAAI,SAACC,GACpC,OAAOC,mBAAmBD,GAAO,IAAMC,mBAAmBnB,EAAOkB,OAChEE,KAAK,MAEd/B,QAAQC,IAAI,iBAAkBuB,GAC9B,IAAIQ,GAAG,gBACLP,OAAAA,EACAQ,QAAS,IAAIC,QAAQC,IAAAA,IAAAA,UACjBxB,GAAqB,QAAXc,GAAoB,CAAEW,KAAMhB,KAAKiB,UAAU1B,KAHpD,IAIL2B,SAAUH,IAAAA,IAAAA,WAEZnC,QAAQC,IAAI,eAAgB+B,GACxBO,MAAMf,GAAD,QAAC,QACJC,OAAAA,EACAQ,QAAS,IAAIC,QAAQC,IAAAA,IAAAA,UACjBxB,GAAqB,QAAXc,GAAoB,CAAEW,KAAMhB,KAAKiB,UAAU1B,KAHtD,IAKH2B,SAAUH,IAAAA,IAAAA,YAETK,MAAK,SAAAC,GACZzC,QAAQC,IAAI,eAAgBwC,GACpB,IACEA,EAAIC,OAAOF,MAAK,SAAAG,GAC1B3C,QAAQC,IAAR,uBAA4BuB,EAA5B,UAAyCmB,GACxBF,EAAIG,IAAIzB,EAAO,CAAC0B,OAAQJ,EAAII,OAAQC,WAAYL,EAAIK,WAAYvC,QAASoC,EAAKpC,QAAUoC,EAAKpC,QAAUkC,EAAIK,aAChH5B,EAAQyB,MAEV,MAAOtC,GACPL,QAAQI,MAAR,gBAAuBoB,EAAvB,WAAqCnB,GACrCc,EAAOd,OAGV0C,OAAM,SAAA1C,GACLL,QAAQI,MAAR,gBAAuBoB,EAAvB,WAAqCnB,GACrCc,EAAOd,UAMf,ICpFO,SAASK,EAAOsC,EAAhB,GAAiD,IAAzBjD,EAAwB,EAAxBA,QAASK,EAAe,EAAfA,MAAO6C,EAAQ,EAARA,OAC7CC,EAAAA,EAAAA,IACEzC,EAAAA,QAAA,UAAgBuC,IACbR,MAAK,SAACG,GAAD,OAAU5C,EAAQ4C,MACvBI,OAAM,SAACJ,GAAD,OAAUvC,EAAMuC,MACtBQ,SAAQ,SAACR,GAAD,OAAUM,EAAMN,OAKxB,SAAS9B,EAAcmC,EAAvB,GAAwD,IAAzBjD,EAAwB,EAAxBA,QAASK,EAAe,EAAfA,MAAO6C,EAAQ,EAARA,MACtDjD,QAAQC,IAAI,wBAAyB+C,IACnCE,EAAAA,EAAAA,IACEzC,EAAAA,eAAA,UAAuBuC,IACpBR,MAAK,SAACG,GAAD,OAAU5C,EAAQ4C,MACvBI,OAAM,SAACJ,GAAD,OAAUvC,EAAMuC,MACtBQ,SAAQ,SAACR,GAAD,OAAUM,EAAMN,OAaxB,SAASS,EAAaC,EAAtB,GAA0D,IAAzBtD,EAAwB,EAAxBA,QAASK,EAAe,EAAfA,MAAO6C,EAAQ,EAARA,OACtDC,EAAAA,EAAAA,IACEzC,EAAAA,aAAkB4C,GACfb,MAAK,SAACG,GAAD,OAAU5C,EAAQ4C,MACvBI,OAAM,SAACJ,GAAD,OAAUvC,EAAMuC,MACtBQ,SAAQ,SAACR,GAAD,OAAUM,EAAMN,OAuBxB,SAAS7C,EAAT,GAA2C,IAAzBC,EAAwB,EAAxBA,QAASK,EAAe,EAAfA,MAAO6C,EAAQ,EAARA,OACvCC,EAAAA,EAAAA,IACEzC,EAAAA,UACG+B,MAAK,SAACG,GAAD,OAAU5C,EAAQ4C,MACvBI,OAAM,SAACJ,GAAD,OAAUvC,EAAMuC,MACtBQ,SAAQ,SAACR,GAAD,OAAUM,EAAMN","sources":["components/auth/SignOut.js","libs/Auth.js","libs/TrackPromise.js"],"sourcesContent":["import React from \"react\";\nimport { useEffect, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\nimport { signOut } from \"../../libs/TrackPromise\";\nimport { AuthContext } from \"../../providers/AuthProvider\";\nimport { OnlineStatusContext } from \"../../providers/OnlineStatusProvider\";\nimport { toast } from \"../Toast\";\n\n\n\nfunction SignOut() {\n  const history = useHistory();\n  const isOnline = useContext(OnlineStatusContext);\n  const { auth, setAuth } = useContext(AuthContext);\n  const { t } = useTranslation();\n\n  // use `useEffect` to avoid  \"cannot update a component while rendering a different component\" error\n  useEffect(() => {\n    if (!isOnline) { // fake signout while offline...\n      // TODO: we should also at least clear localStorage.CognitoIdentityServiceProvider.* keys ...\n      //return toast.warning(\"You are currently offline. Please wait for the network to become available.\");\nconsole.log(\"signOut calling setAuth\");\n      setAuth({ user: false });\n      history.replace(\"/\");\n    } else {\n      signOut({\n        success: () => {\n          //toast.success(t(\"Signed out\")); // too noisy...\nconsole.log(\"signOut calling setAuth\");\nconsole.log(\"SETAUTH auth:\", auth);\n          setAuth({ user: false })\nconsole.log(\"SETAUTH auth:\", auth);\n          history.replace(\"/\");\n        },\n        error: (err) => {\nconsole.error(\"signOut error:\", err);\n          toast.error(t(err.message));\n        }\n      });\n    }\n  }, [isOnline, history, auth, setAuth, t]);\n\n  return null;\n};\n\nexport default React.memo(SignOut);\n","//import  { Redirect } from \"react-router-dom\";\nimport config from \"../config\";\n//import { currentFunctionName } from \"../libs/Misc\";\n\nconst Auth = {\n  signUp: (params) => {\n    //console.log(currentFunctionName(), params);\n    return fetcher(\"/api/auth/register\", \"POST\", params);\n  },\n  confirmSignUp: (params) => {\n    //console.log(currentFunctionName(), params);\n    // TODO: props = props.filter(key => key === \"code\");\n    return fetcher(`/api/auth/verify/${params.code}`, \"GET\", params); // TODO: change the name: choose verify or confirmSignUp, and code or token (better code) ...\n  },\n  signIn: (params) => {\n    //console.log(currentFuncionName(), params);\n    return fetcher(\"/api/auth/login\", \"POST\", params);\n  },\n//   federatedSignIn: (params) => {\n// console.log(\"*********************\", currentFunctionName(), params);\n//     const retur = fetcher(\"/api/auth/loginGoogle\", \"GET\", params); // TODO: use the federated login based on params\n// alert(JSON.stringify(retur));\n// return retur;\n//     //return <Redirect to=\"/api/auth/loginGoogle\" />\n//   },\n  UNUSEDcurrentAuthenticatedUser: (params) => {\n\n    //return fetcher(\"/api/auth/currentAuthenticatedUser\", \"GET\", params);\n\n    //console.log(currentFunctionName(), params);\n    return new Promise((resolve, reject) => {\n      const auth = JSON.parse(localStorage.getItem(\"auth\"));\n      console.log(\"currentAuthenticatedUser auth:\", auth);\n      resolve(auth ? auth.user : false);\n    });\n\n//       // TODO: https://www.bezkoder.com/jwt-refresh-token-node-js/ (for server side refresh token handling)\n//       // TODO:\n// /*\n//       function isAuthenticated() {\n//         const accessToken = localStorage.getItem('accessToken');\n//         const refreshToken = localStorage.getItem('refreshToken');\n//         try {\n//           decode(accessToken);\n//           const { exp } = decode(refreshToken);\n//           if (Date.now() >= exp * 1000) {\n//             return false;\n//           }\n//         } catch (err) {\n//           return false;\n//         }\n//         return true;\n//       }\n// */\n\n//       //console.log(currentFunctionName(), \"auth:\", auth);\n//       if (auth) {\n//         //console.log(currentFunctionName(), \"resolving auth.user:\", auth.user);\n//         resolve(auth.user);\n//       } else {\n//         //console.log(currentFunctionName(), \"rejecting\");\n//         reject();\n//       }\n//     });\n  },\n  signOut: (params) => {\n    //console.log(currentFunctionName());\n    // nothing to do\n    return new Promise((resolve, reject) => {\n      resolve();\n    });\n  },\n};\n\nconst fetcher = (url, method, params) => {\nconsole.log(\"fetcher:\", url, method, params);\n  return new Promise((resolve, reject) => {\n    if (method === \"GET\" && params) {\n      url += \"?\" + Object.keys(params).map((key) => {\n        return encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key])\n      }).join(\"&\");\n    }\nconsole.log(\"fetcher url 2:\", url);\nvar opt = {\n  method,\n  headers: new Headers(config.api.headers),\n  ...(params && method !== \"GET\" && { body: JSON.stringify(params) }),\n  redirect: config.api.redirect,\n}\nconsole.log(\"fetcher opt:\", opt);\n    fetch(url, {\n      method,\n      headers: new Headers(config.api.headers),\n      ...(params && method !== \"GET\" && { body: JSON.stringify(params) }),\n      //body: new URLSearchParams(params),\n      redirect: config.api.redirect,\n    })\n      .then(res => {\nconsole.log(\"fetcher res:\", res);\n        try {\n          res.json().then(data => {\nconsole.log(`fetcher from ${url} data:`, data);\n            if (!res.ok) reject({status: res.status, statusText: res.statusText, message: data.message ? data.message : res.statusText})\n            resolve(data);\n          });\n        } catch (err) {\n          console.error(`fetch ${url} error:`, err); // TODO: !!!\n          reject(err);\n        }\n      })\n      .catch(err => {\n        console.error(`fetch ${url} error:`, err); // TODO: !!!\n        reject(err);\n      })\n    ;\n  });\n}\n\nexport default Auth;","//import React from \"react\";\n//import { Auth } from \"aws-amplify\";\nimport { trackPromise } from \"react-promise-tracker\";\nimport Auth from \"./Auth\";\n\n\n\nexport function NOTUSEDcurrentAuthenticatedUser({success, error, final}) {\n  trackPromise(\n    Auth.NOTUSEDcurrentAuthenticatedUser()\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n   );\n}\n\nexport function signIn(props, {success, error, final}) {\n  trackPromise(\n    Auth.signIn({...props})\n      .then((data) => {console.log(\"success:\", data); success(data)})\n      .catch((data) => {console.log(\"error:\", data); error(data)})\n      .finally((data) => final(data))\n  );\n}\n\nexport function federatedSignIn(props, {success, error, final}) {\n  trackPromise(\n    Auth.federatedSignIn({...props})\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n}\n  \nexport function signUp(props, {success, error, final}) {\n  trackPromise(\n    Auth.signUp({...props})\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\n//export function confirmSignUp(username, code, {success, error, final}) {\nexport function confirmSignUp(props, {success, error, final}) {\nconsole.log('TrackPromise - props:', props);\n  trackPromise(\n    Auth.confirmSignUp({...props})\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function forgotPassword(username, {success, error, final}) {\n  trackPromise(\n    Auth.forgotPassword(username)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function resendSignUp(username, {success, error, final}) {\n  trackPromise(\n    Auth.resendSignUp(username)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function forgotPasswordSubmit(username, code, password, {success, error, final}) {\n  trackPromise(\n    Auth.forgotPasswordSubmit(username, code, password,)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function resendResetPasswordCode(username, {success, error, final}) {\n  trackPromise(\n    //Auth.resendResetPassword(username)\n    Auth.resendSignUp(username)\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n\nexport function signOut({success, error, final}) {\n  trackPromise(\n    Auth.signOut()\n      .then((data) => success(data))\n      .catch((data) => error(data))\n      .finally((data) => final(data))\n  );\n};\n"],"names":["SignOut","history","useHistory","isOnline","useContext","OnlineStatusContext","AuthContext","auth","setAuth","t","useTranslation","useEffect","signOut","success","console","log","user","replace","error","err","toast","message","React","Auth","signUp","params","fetcher","confirmSignUp","code","signIn","UNUSEDcurrentAuthenticatedUser","Promise","resolve","reject","JSON","parse","localStorage","getItem","url","method","Object","keys","map","key","encodeURIComponent","join","opt","headers","Headers","config","body","stringify","redirect","fetch","then","res","json","data","ok","status","statusText","catch","props","final","trackPromise","finally","resendSignUp","username"],"sourceRoot":""}