/*! For license information please see 15.e163417f.chunk.js.LICENSE.txt */
(this["webpackJsonpappalti190-client"]=this["webpackJsonpappalti190-client"]||[]).push([[15],{306:function(e,t,n){"use strict";var o=n(21),a=n(312),c=n(0),r=n.n(c),i=n(292),l=n(361),s=n(346),d=n(362),u=n(363),b=n(364),j=n(1),f=["title","contentText","actions"],O=function(e){var t=e.title,n=e.contentText,c=e.actions,r=Object(a.a)(e,f);return Object(j.jsxs)(l.a,Object(o.a)(Object(o.a)({},r),{},{onBackdropClick:function(){},"aria-labelledby":t,onClose:function(e,t){},children:[Object(j.jsx)(s.a,{children:t}),Object(j.jsx)(d.a,{children:Object(j.jsx)(u.a,{children:n})}),Object(j.jsx)(b.a,{children:c.map((function(e,t){return Object(j.jsx)(i.a,{onClick:function(){e.callback&&e.callback(),e.closeModal&&r.onClose()},variant:"primary"===e.variant?"contained":"secondary"===e.variant?"outlined":"contained",autoFocus:r,style:{textTransform:"none"},children:e.text},t)}))})]}))};O.defaultProps={title:"",contentText:"",actions:[{text:"Ok",closeModal:!0,callback:function(){},variant:"primary",autoFocus:!1}]},t.a=r.a.memo(O)},315:function(e,t,n){"use strict";var o=n(104),a=n(87),c=n.n(a),r=n(31),i=n(45),l=function(){var e=Object(o.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.a.getUser()){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,r.a.get("/job/get");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s={get:l,set:function(e){return i.a.getUser()?r.a.put("/job/set",{job:e}):null},upload:function(e){var t=new FormData;return t.append("file",e),r.a.post("/job/upload",t,{headers:{"Content-Type":"multipart/form-data"}})},transformXls2Xml:function(e){return r.a.post("/job/transformXls2Xml/:filePath",{filePath:e})},validateXml:function(e){return r.a.post("/job/validateXml/:transform",{transform:e})},outcomeCheck:function(e,t){return r.a.post("/job/outcomeCheck/:anno/:codiceFiscaleAmministrazione",{anno:e,codiceFiscaleAmministrazione:t})},outcomeFailureDetails:function(e,t){return r.a.post("/job/outcomeFailureDetails/anno/codiceFiscaleAmministrazione",{anno:e,codiceFiscaleAmministrazione:t})},urlExistenceCheck:function(e){return r.a.post("/job/urlExistenceCheck/url",e)},sanitizeJob:function(e){var t;if(null===e||void 0===e||null===(t=e.transform)||void 0===t||!t.xml)return e;var n=e;return n.transform.xml="\u2026",n},getPlans:function(){return r.a.get("/job/getPlans")}};t.a=s},457:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),c=n(285),r=n(14),i=n(21),l=n(312),s=n(294),d=n(468),u=n(297),b=n(301),j=n(458),f=n(469),O=n(296),p=n(414),m=n(45),v=n(315),h=n(292),x=n(471);var g=n(1),k=Object(c.a)((function(e){return{paragraph:{fontSize:"1.1em"},paragraphSmall:{fontSize:"0.8em"},centered:{display:"flex",justifyContent:"center",alignItems:"center"},justified:{textAlign:"justify"},box:{display:"flex"},boxLeft:{justifyContent:"flex-start"},boxRight:{justifyContent:"flex-end"},sup:{fontSize:"0.8em"},scrollableContainer:{display:"flex",flexDirection:"column",marginTop:"1em",minHeight:"5em"},scrollable:{height:"100%",overflowY:"auto",paddingLeft:10,paddingRight:10,minHeight:"3em"}}})),w=a.a.memo((function(e){return Object(g.jsx)("div",{children:e.children})}));w.defaultProps={};var C=a.a.memo((function(e){var t=k(),n=function(){var e=Object(o.useState)({width:window.innerWidth,height:window.innerHeight}),t=Object(r.a)(e,2),n=t[0],a=t[1];return Object(o.useEffect)((function(){function e(){a({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}();return Object(g.jsx)("div",{className:t.scrollableContainer,children:Object(g.jsx)("div",{className:t.scrollable,style:{height:Math.max(120,n.height-90-100-90)},children:e.children})})}));C.defaultProps={};var I=a.a.memo((function(e){var t=k();return Object(g.jsx)("div",{className:t.centered,children:Object(g.jsx)("h2",{children:e.children})})}));I.defaultProps={};var y=a.a.memo((function(e){var t=k();return Object(g.jsx)(p.a,{mb:1,children:Object(g.jsx)(O.a,{component:"div",className:"".concat(t.paragraph," ").concat(t.justified," ").concat(e.small?t.paragraphSmall:null," ").concat(e.class),children:e.children})})}));y.defaultProps={class:null};var E=a.a.memo((function(e){var t=k();return Object(g.jsx)(p.a,{component:"span",m:1,className:"".concat(t.box," ").concat(t.boxLeft),children:Object(g.jsx)(h.a,{variant:"contained",color:"secondary",onClick:e.onPrev,disabled:!e.prevIsEnabled,children:e.children})})}));E.defaultProps={};var P=a.a.memo((function(e){var t=k();return Object(g.jsx)(p.a,{component:"span",m:1,className:"".concat(t.box," ").concat(t.boxRight),children:Object(g.jsx)(h.a,{variant:"contained",color:"secondary",onClick:e.onNext,disabled:!e.nextIsEnabled,children:e.children})})}));P.defaultProps={};var S=a.a.memo((function(e){var t=k();return Object(g.jsx)(x.a,{title:e.title,placement:"top",children:Object(g.jsx)("sup",{className:t.sup,children:e.anchor})})}));function N(e){var t=Object(s.a)().t,n=Object(o.useState)(!0),a=Object(r.a)(n,1)[0];return Object(g.jsxs)(w,{children:[Object(g.jsxs)(C,{children:[Object(g.jsx)(I,{children:t("Welcome!")}),Object(g.jsxs)(y,{children:["Questa \xe8 la nostra proposta per adempiere i requisiti della "," ",Object(g.jsx)("a",{href:"https://www.anticorruzione.it/-/adempimenti-legge-190/2012-art.-1-comma-32-7",target:"legge190",children:"Legge 190"}),". Speriamo che sia chiara e semplice da usare."]}),Object(g.jsx)(y,{children:"Questa app ti guider\xe0 passo passo nei pochi passi che occorrono per completare l'adempimento con successo."}),Object(g.jsxs)(y,{children:["Per iniziare dovrai scaricare un modello Excel",Object(g.jsx)(S,{title:"Pu\xf2 essere in formato MicroSoft-Excel, oppure in formato ODS, come preferisci."}),", che contiene delle regole per guidarti nella compilazione, e minimizzare i possibili errori formali."]}),Object(g.jsx)(y,{children:"Poi dovrai inserire, uno per riga, tutti i beni o servizi che la tua struttura ha appaltato nell'anno in corso."}),Object(g.jsx)(y,{children:"Alla fine dell'anno, in genere entro la fine di Gennaio dell'anno successivo, sar\xe0 sufficiente caricare qui il foglio Excel compilato."}),Object(g.jsx)(y,{children:"A questo punto il nostro sistema effettuer\xe0 il controllo formale dei dati inseriti. Nel caso che venga segnalata qualche anomalia dovrai correggere sul file Excel le anomalie segnalate, e poi ri-caricarlo."}),Object(g.jsx)(y,{children:"Dopodich\xe8 potrai scaricare il documento XML prodotto, che andr\xe0 pubblicato sul sito cui fa riferimento la tua struttura."}),Object(g.jsx)(y,{children:"A questo punto avrai praticamente completato l'adempimento. Se vorrai potrai controllare - sempre su questo sito - l'esito della verifica da parte dell'ANAC."}),Object(g.jsx)(y,{children:'Tieni presente che siamo sempre disponibili a risponderti per qualsiasi dubbio o incertezza. Le modalit\xe0 di assistenza sono diverse, dal supporto telefonico a quello per email, e dipendono anche dal piano scelto. I riferimenti sono presenti nel menu, alla voce "Supporto".'})]}),Object(g.jsx)("div",{children:Object(g.jsx)(P,{onNext:function(){e.goto("next")},nextIsEnabled:a,children:t("Start")})})]})}S.defaultProps={anchor:"*"},N.defaultProps={};var D=a.a.memo(N),T=n(18),z=n(107),A=n(290),J=n(59),U=n(306),F=n(20),R=n.n(F),M=n(75);function L(e){var t=Object(s.a)().t,n=Object(T.f)(),a=Object(o.useState)(!0),c=Object(r.a)(a,1)[0],l=Object(o.useState)((function(){var t,n;return!(null===(t=e.job)||void 0===t||!t.download)&&(null===(n=e.job)||void 0===n?void 0:n.download)})),d=Object(r.a)(l,2),u=d[0],b=d[1],j=Object(z.b)().showModal,f=function(){return!!J.a.getCurrentUser()||(function(e){j(U.a,e)}({title:t("Please log in or register"),contentText:t("You need to be authenticated to proceed"),actions:[{text:t("Login"),closeModal:!0,autoFocus:!0,callback:function(){m.a.set("redirect",e.tabId),n.push("/signin")}},{text:t("Register"),closeModal:!0,callback:function(){m.a.set("redirect",e.tabId),n.push("/signup")}},{text:t("Cancel"),closeModal:!0,callback:function(){return e.goto("prev")}}]}),!1)};return Object(g.jsxs)(w,{children:[Object(g.jsxs)(C,{children:[Object(g.jsx)(I,{children:t("Download")}),Object(g.jsx)(y,{children:"Scarica il modello Excel in cui potrai inserire i dati degli appalti, uno per riga."}),Object(g.jsx)(y,{children:Object(g.jsxs)(h.a,{onClick:function(){f()&&(Object(M.c)(R.a.data.templateDownloadUrl),b(!0),e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{download:!0})))},variant:"contained",color:"tertiary",children:[t("Download")," \u2b07"]})})]}),Object(g.jsxs)(A.a,{container:!0,children:[Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(E,{onPrev:function(){e.goto("prev")},prevIsEnabled:c,children:t("Back")})}),Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(P,{onNext:function(){e.goto("next")},nextIsEnabled:u,children:t("Continue")})})]})]})}L.defaultProps={};var X=a.a.memo(L),q=Object(c.a)((function(e){return{ul:{padding:32}}}));function B(e){var t=q(),n=Object(s.a)().t,a=Object(o.useState)(!0),c=Object(r.a)(a,1)[0],i=Object(o.useState)(!0),l=Object(r.a)(i,1)[0];return Object(g.jsxs)(w,{children:[Object(g.jsxs)(C,{children:[Object(g.jsx)(I,{children:n("Fill your data")}),Object(g.jsx)(y,{children:"Adesso puoi aprire il modello scaricato con il tuo programma di gestione fogli di lavoro."}),Object(g.jsxs)(y,{children:['Sono presenti 2 fogli: "METADATI" ed "ELENCO GARE".',Object(g.jsx)("br",{}),'Ti consigliamo di iniziare dal primo foglio, "METADATI", ed inserire i 4 dati generali richiesti:',Object(g.jsxs)("ul",{className:t.ul,children:[Object(g.jsxs)("li",{children:[Object(g.jsx)("i",{children:"codiceFiscaleStrutturaProponente"})," il codice fiscale della tua struttura"]}),Object(g.jsxs)("li",{children:[Object(g.jsx)("i",{children:"denominazioneStrutturaProponente"})," la ragione sociale della tua struttura"]}),Object(g.jsxs)("li",{children:[Object(g.jsx)("i",{children:"annoRiferimento"})," l'anno di riferimento per cui inserirai gli appalti"]}),Object(g.jsxs)("li",{children:[Object(g.jsx)("i",{children:"urlFile"})," l'indirizzo URL dove sar\xe0 pubblicato il documento finale"]})]})]}),Object(g.jsx)(y,{children:'A questo punto puoi passare al secondo foglio, "ELENCO GARE". Occorre inserire ogni appalto (o "gara"), uno per riga.'}),Object(g.jsxs)(y,{children:["I campi da compilare sono:",Object(g.jsxs)("ul",{className:t.ul,children:[Object(g.jsxs)("li",{children:[Object(g.jsx)("i",{children:"CIG"})," il Codice Identificativo Gara"]}),"... TODO: documentare tutti gli altri campi..."]})]})]}),Object(g.jsxs)(A.a,{container:!0,children:[Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(E,{onPrev:function(){e.goto("prev")},prevIsEnabled:c,children:n("Back")})}),Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(P,{onNext:function(){e.goto("next")},nextIsEnabled:l,children:n("Continue")})})]})]})}B.defaultProps={};var G=a.a.memo(B),_=n(104),W=n(87),Y=n.n(W),H=n(76),$=n(412),V={flex:1,display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",borderWidth:2,borderRadius:2,borderColor:"blue",borderStyle:"dashed",backgroundColor:"#fafafa",color:"#353535",outline:"none",transition:"border .24s ease-in-out"},Q={backgroundColor:"lightyellow",borderColor:"purple"},K={backgroundColor:"lightgreen",borderColor:"darkgreen"},Z={backgroundColor:"lightred",borderColor:"darkred"},ee=function(e){var t=e.onDrop,n=e.accept,a=Object(s.a)().t,c=Object($.a)({onDrop:t,accept:n}),r=c.getRootProps,l=c.getInputProps,d=c.isFocused,u=c.isDragAccept,b=c.isDragReject,j=c.isDragActive,f=Object(o.useMemo)((function(){return Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)({},V),d?Q:{}),u?K:{}),b?Z:{})}),[d,u,b]);return Object(g.jsxs)("div",Object(i.a)(Object(i.a)({className:"dropzone-div"},r({style:f})),{},{children:[Object(g.jsx)("input",Object(i.a)({className:"dropzone-input"},l())),Object(g.jsx)("div",{className:"text-center",children:j?Object(g.jsx)("p",{className:"dropzone-content",children:a("Release to drop the files here")}):Object(g.jsx)("p",{className:"dropzone-content",children:a("Drag 'n drop some files here, or click to select files")})})]}))};function te(e){var t,n,a,c,l,d,u,b=Object(s.a)().t,j=Object(T.f)(),f=Object(o.useState)(!0),O=Object(r.a)(f,1)[0],p=Object(o.useState)(!(null===e||void 0===e||null===(t=e.job)||void 0===t||!t.file)),x=Object(r.a)(p,2),k=x[0],S=x[1],N=Object(z.b)().showModal,D=Object(o.useState)([".csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"]),F=Object(r.a)(D,1)[0],R=function(){return!!J.a.getCurrentUser()||(function(e){N(U.a,e)}({title:b("Please log in or register"),contentText:b("You need to be authenticated to proceed"),actions:[{text:b("Login"),closeModal:!0,autoFocus:!0,callback:function(){m.a.set("redirect",e.tabId),j.push("/signin")}},{text:b("Register"),closeModal:!0,callback:function(){m.a.set("redirect",e.tabId),j.push("/signup")}},{text:b("Cancel"),closeModal:!0,callback:function(){return e.goto("prev")}}]}),!1)},L=Object(o.useCallback)((function(){return R()}),[]);Object(o.useEffect)((function(){L()}),[L]);var X=Object(o.useCallback)(function(){var t=Object(_.a)(Y.a.mark((function t(n){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{file:n}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]),q=Object(o.useCallback)(Object(_.a)(Y.a.mark((function t(){var n;return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n={}).tabId=e.job.tabId,e.setJob(n),S(!1);case 4:case"end":return t.stop()}}),t)}))),[e]),B=Object(o.useCallback)((function(e){var t,n,o,a;return null!==e&&void 0!==e&&null!==(t=e.type)&&void 0!==t&&null!==(n=t.split("/")[1])&&void 0!==n&&n.match("officedocument.spreadsheetml.sheet")||null!==e&&void 0!==e&&null!==(o=e.type)&&void 0!==o&&null!==(a=o.split("/")[1])&&void 0!==a&&a.match("ms-excel")?null:b("Please upload a spreadsheet")+"."+(null!==e&&void 0!==e&&e.type?" "+b("Selected file looks like {{fileType}}",{fileType:e.type}):"")}),[b]),G=Object(o.useCallback)(function(){var t=Object(_.a)(Y.a.mark((function t(n){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.upload(n).then((function(e){console.log("Upload success, file path",e.data.file),X(e.data.file)}),(function(t){console.error("Upload error:",t),q(),e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{file:{error:Object(M.f)(t)}})),H.b.error(Object(M.f)(t))}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e,X,q]),W=Object(o.useCallback)(function(){var t=Object(_.a)(Y.a.mark((function t(n){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=13;break}if(!B(n)){t.next=7;break}e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{file:null})),S(!1),t.next=11;break;case 7:return e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{file:n})),t.next=10,G(n);case 10:S(!0);case 11:t.next=16;break;case 13:H.b.error(b("No file selected, sorry... Please, repeat...")),e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{file:null})),S(!1);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e,G,B,b]),$=Object(o.useCallback)((function(e){console.log("accepted files:",e),W(e[0])}),[W]),V=function(){var t=Object(_.a)(Y.a.mark((function t(){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.goto("next");case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(g.jsxs)(w,{children:[Object(g.jsxs)(C,{children:[Object(g.jsx)(I,{children:b("Upload")}),Object(g.jsx)(y,{children:"Carica il foglio Excel compilato:"}),Object(g.jsxs)("div",{className:"container",children:[Object(g.jsx)(ee,{onDrop:$,accept:F}),Object(g.jsx)("br",{}),Object(g.jsxs)(y,{children:[(null===e||void 0===e||null===(n=e.job)||void 0===n||null===(a=n.file)||void 0===a?void 0:a.originalname)&&b("Selected file")+": ".concat(null===e||void 0===e||null===(c=e.job)||void 0===c||null===(l=c.file)||void 0===l?void 0:l.originalname),Object(g.jsx)("br",{}),(null===e||void 0===e||null===(d=e.job)||void 0===d||null===(u=d.file)||void 0===u?void 0:u.originalname)&&Object(g.jsx)(h.a,{variant:"contained",size:"small",onClick:q,title:b("Remove file"),children:" \ud83d\uddd1 "})]})]})]}),Object(g.jsxs)(A.a,{container:!0,children:[Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(E,{onPrev:function(){e.goto("prev")},prevIsEnabled:O,children:b("Back")})}),Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(P,{onNext:V,nextIsEnabled:k,children:b("Continue")})})]})]})}te.defaultProps={};var ne=a.a.memo(te),oe=n(460),ae=n(472),ce=n(473),re=n(390),ie=n.n(re),le=Object(c.a)((function(e){return{"& .MuiTypography-root":{fontSize:"0.5em"},accordionRoot:{_height:"4em",_padding:0,_margin:0,fontSize:"0.9em"}}}));function se(e){var t,n,a,c,l,d,u,b,j,f,p,h,x,k,S,N,D,J,F,R,L,X,q,B,G,W,$,V,Q,K,Z,ee,te,ne,re,se,de,ue,be,je=Object(s.a)().t,fe=le(),Oe=Object(T.f)(),pe=m.a.getUser(),me=Object(o.useState)({}),ve=Object(r.a)(me,2),he=ve[0],xe=ve[1],ge=Object(o.useState)(!1),ke=Object(r.a)(ge,2),we=ke[0],Ce=ke[1],Ie=Object(o.useState)(!0),ye=Object(r.a)(Ie,1)[0],Ee=Object(z.b)().showModal;Object(o.useEffect)((function(){var t,n,o,a,c,r,l,s,d,u,b,j;(console.log("useeffect 1",e.job),null!==(t=e.job)&&void 0!==t&&t.transform)?"TRUNCATED_DUE_TO_PLAN_LIMIT"===(null===(n=e.job)||void 0===n||null===(o=n.transform)||void 0===o?void 0:o.code)&&(null!==(a=e.job)&&void 0!==a&&null!==(c=a.transform)&&void 0!==c&&c.planUpgradeDeclined||(console.log("useeffect 1 ENTERED"),function(e){Ee(U.a,e)}({title:je("Please upgrade your plan"),contentText:je("You need to upgrade your plan to proceed.")+"\n"+je('Your current plan is "{{planName}}".',{planName:null===pe||void 0===pe||null===(r=pe.plan)||void 0===r?void 0:r.name})+"\n"+je('To elaborate {{cigCount}} CIGs you need at least plan "{{planName}}"',{cigCount:null===(l=e.job)||void 0===l||null===(s=l.transform)||void 0===s?void 0:s.cigCount,planName:null===(d=e.job)||void 0===d||null===(u=d.transform)||void 0===u||null===(b=u.planRequired)||void 0===b?void 0:b.name}),actions:[{text:je("Upgrade plan"),closeModal:!0,autoFocus:!0,callback:function(){m.a.set("redirect",e.tabId),Oe.push("/profile",{tabValue:1})}},{text:je("Proceed with the first {{cigNumberAllowed}} CIGs",{cigNumberAllowed:null===pe||void 0===pe||null===(j=pe.plan)||void 0===j?void 0:j.cigNumberAllowed}),closeModal:!0,callback:function(){var t;Ce(!0),e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{transform:Object(i.a)(Object(i.a)({},null===(t=e.job)||void 0===t?void 0:t.transform),{},{planUpgradeDeclined:!0})}))}}]}))):Ce(!0)}),[null===(t=e.job)||void 0===t?void 0:t.transform]),Object(o.useEffect)((function(){console.log("useeffect 2",e.job),e.job.file&&!e.job.transform&&(console.log("useeffect 2 ENTERED"),Object(_.a)(Y.a.mark((function t(){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return xe({loading:!0}),t.next=3,v.a.transformXls2Xml(e.job.file.path).then((function(t){if(t instanceof Error)return e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{transform:t})),H.b.error(Object(M.f)(t)),xe({error:Object(M.f)(t)});console.log("useeffect 2 - setting job.transform to:",t.data.result),e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{transform:t.data.result})),xe({success:t.data})}));case 3:case"end":return t.stop()}}),t)})))())}),[]),Object(o.useEffect)((function(){console.log("useeffect 3",e.job),e.job.file&&e.job.transform&&!e.job.validateXml&&(console.log("useeffect 3 ENTERED"),Object(_.a)(Y.a.mark((function t(){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return xe({loading:!0}),t.next=3,v.a.validateXml(e.job.transform).then((function(t){if(t instanceof Error)return e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{validateXml:t})),H.b.error(Object(M.f)(t)),xe({error:Object(M.f)(t)});e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{validateXml:t.data})),xe({success:t.data})}),(function(t){e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{validateXml:t}))}));case 3:case"end":return t.stop()}}),t)})))())}),[e.job.transform]);var Pe=[];null!==(n=e.job)&&void 0!==n&&n.file&&(Pe[je("Original file name")]=e.job.file.originalname),null!==(a=e.job)&&void 0!==a&&null!==(c=a.transform)&&void 0!==c&&null!==(l=c.metadati)&&void 0!==l&&l.titolo&&(Pe[je("Title")]=e.job.transform.metadati.titolo),null!==(d=e.job)&&void 0!==d&&null!==(u=d.transform)&&void 0!==u&&null!==(b=u.metadati)&&void 0!==b&&b.abstract&&(Pe[je("Abstract")]=e.job.transform.metadati.abstract),null!==(j=e.job)&&void 0!==j&&null!==(f=j.transform)&&void 0!==f&&null!==(p=f.metadati)&&void 0!==p&&p.dataPubblicazioneDataset&&(Pe[je("Dataset publish date")]=e.job.transform.metadati.dataPubblicazioneDataset),null!==(h=e.job)&&void 0!==h&&null!==(x=h.transform)&&void 0!==x&&null!==(k=x.metadati)&&void 0!==k&&k.dataUltimoAggiornamentoDataset&&(Pe[je("Dateset last update date")]=e.job.transform.metadati.dataUltimoAggiornamentoDataset),null!==(S=e.job)&&void 0!==S&&null!==(N=S.transform)&&void 0!==N&&null!==(D=N.metadati)&&void 0!==D&&D.entePubblicatore&&(Pe[je("Publishing body")]=e.job.transform.metadati.entePubblicatore),null!==(J=e.job)&&void 0!==J&&null!==(F=J.transform)&&void 0!==F&&null!==(R=F.metadati)&&void 0!==R&&R.annoRiferimento&&(Pe[je("Reference year")]=e.job.transform.metadati.annoRiferimento),null!==(L=e.job)&&void 0!==L&&null!==(X=L.transform)&&void 0!==X&&null!==(q=X.metadati)&&void 0!==q&&q.urlFile&&(Pe[je("Url file")]=e.job.transform.metadati.urlFile),null!==(B=e.job)&&void 0!==B&&null!==(G=B.transform)&&void 0!==G&&null!==(W=G.metadati)&&void 0!==W&&W.licenza&&(Pe[je("License")]=e.job.transform.metadati.licenza),null!==($=e.job)&&void 0!==$&&$.cigCount&&(Pe[je("Number of CIGs")]=e.job.cigCount),null!==(V=e.job)&&void 0!==V&&V.importoAggiudicazioneTotale&&(Pe[je("Total award amount")]=e.job.importoAggiudicazioneTotale),null!==(Q=e.job)&&void 0!==Q&&Q.importoSommeLiquidateTotale&&(Pe[je("Total liquidated amount")]=e.job.importoSommeLiquidateTotale);var Se,Ne,De,Te,ze="",Ae=[];null!==(K=e.job)&&void 0!==K&&null!==(Z=K.transform)&&void 0!==Z&&Z.warnings.length&&(ze="".concat(null===(Se=e.job)||void 0===Se||null===(Ne=Se.transform)||void 0===Ne?void 0:Ne.warnings.length," ").concat(je("transformation warnings")),Ae=null===(De=e.job)||void 0===De||null===(Te=De.transform)||void 0===Te?void 0:Te.warnings.map((function(e,t){return{type:je("transformation warning"),header:"".concat(t+1),content:e}})));var Je,Ue,Fe,Re,Me="",Le=[];null!==(ee=e.job)&&void 0!==ee&&null!==(te=ee.transform)&&void 0!==te&&te.errors.length&&(Me="".concat(null===(Je=e.job)||void 0===Je||null===(Ue=Je.transform)||void 0===Ue?void 0:Ue.errors.length," ").concat(je("transformation errors")),Le=null===(Fe=e.job)||void 0===Fe||null===(Re=Fe.transform)||void 0===Re?void 0:Re.errors.map((function(e,t){return{type:je("transformation error"),header:"".concat(t+1),content:e}})));var Xe=null===(ne=e.job)||void 0===ne||null===(re=ne.validateXml)||void 0===re||null===(se=re.error)||void 0===se?void 0:se.message,qe=null===(de=e.job)||void 0===de||null===(ue=de.validateXml)||void 0===ue||null===(be=ue.error)||void 0===be?void 0:be.reason,Be=[];if(qe){Be=qe.split("\n");var Ge=/^\t\[([^\]]+)\]\s*([^:]*):\s*(.*)$/;Be.shift();Xe="".concat(Be.length," ").concat(je("xml validation errors")),Be=Be.map((function(e,t){return{type:"xml validation ".concat(e.replace(Ge,"$1")),header:"".concat(e.replace(Ge,"$2")),content:"".concat(e.replace(Ge,"$3"))}}))}var _e="<p>".concat(ze,"</p><p>",Me,"</p><p>",Xe,"</p>"),We=Ae.concat(Le,Be);return console.log("ERRORS:",We),console.log(e.job),Object(g.jsxs)(w,{children:[Object(g.jsxs)(C,{children:[Object(g.jsx)(I,{children:je("Check")}),Object(g.jsxs)(y,{children:[he&&"loading"in he&&"\ud83d\udfe1 ".concat(je("Processing...")),he&&"error"in he&&"\ud83d\udd34 ".concat(je("Errors in validation"),": ").concat(he.error),he&&"success"in he&&"\ud83d\udfe2 ".concat(je("Validation completed successfully"))]}),Object.keys(Pe).length>0&&Object(g.jsxs)("div",{children:[" ",Object.keys(Pe).map((function(e,t){return Object(g.jsxs)("div",{children:[e,": ",Pe[e]]},t)}))]}),We.length>0&&Object(g.jsxs)("div",{style:{color:"darkred"},children:[Object(g.jsx)(y,{children:Object(g.jsx)("h3",{dangerouslySetInnerHTML:{__html:_e}})}),Object(g.jsx)(y,{children:We.map((function(e,t){return Object(g.jsxs)(oe.a,{disableGutters:!0,classes:{root:fe.accordionRoot},style:{color:"darkred"},sx:{"& .MuiTypography-root":{fontSize:".7em"}},children:[Object(g.jsx)(ae.a,{expandIcon:Object(g.jsx)(ie.a,{}),"aria-controls":"panel-error-".concat(t,"-content"),id:"panel-error-".concat(t,"-header"),children:Object(g.jsxs)(O.a,{children:[e.type,": ",e.header]})}),Object(g.jsx)(ce.a,{children:Object(g.jsx)(O.a,{children:e.content})})]},t)}))})]})]}),Object(g.jsxs)(A.a,{container:!0,children:[Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(E,{onPrev:function(){e.goto("prev")},prevIsEnabled:ye,children:je("Back")})}),Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(P,{onNext:function(){e.goto("next")},nextIsEnabled:we,children:je("Continue")})})]})]})}se.defaultProps={};var de=a.a.memo(se);function ue(e){var t=Object(s.a)().t,n=Object(T.f)(),a=Object(o.useState)(!0),c=Object(r.a)(a,1)[0],l=Object(o.useState)((function(){var t,n;return!(null===(t=e.job)||void 0===t||!t.download)&&(null===(n=e.job)||void 0===n?void 0:n.downloadDataset)})),d=Object(r.a)(l,2),u=d[0],b=d[1],j=Object(z.b)().showModal,f=function(){return!!J.a.getCurrentUser()||(function(e){j(U.a,e)}({title:t("Please log in or register"),contentText:t("You need to be authenticated to proceed"),actions:[{text:t("Login"),closeModal:!0,autoFocus:!0,callback:function(){m.a.set("redirect",e.tabId),n.push("/signin")}},{text:t("Register"),closeModal:!0,callback:function(){m.a.set("redirect",e.tabId),n.push("/signup")}},{text:t("Cancel"),closeModal:!0,callback:function(){return e.goto("prev")}}]}),!1)};return Object(g.jsxs)(w,{children:[Object(g.jsxs)(C,{children:[Object(g.jsx)(I,{children:t("Download produced dataset")}),Object(g.jsx)(y,{children:Object(g.jsxs)("p",{children:[t("Download dataset"),"."]})}),Object(g.jsx)(y,{children:Object(g.jsxs)(h.a,{onClick:function(){if(f()){var t=e.job.transform.outputUrl;console.log("job:",e.job),console.log("url:",t),Object(M.d)(t),b(!0),e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{downloadDataset:!0}))}},variant:"contained",color:"tertiary",children:[t("Download")," \u2935"]})})]}),Object(g.jsxs)(A.a,{container:!0,children:[Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(E,{onPrev:function(){e.goto("prev")},prevIsEnabled:c,children:t("Back")})}),Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(P,{onNext:function(){e.goto("next")},nextIsEnabled:u,children:t("Continue")})})]})]})}ue.defaultProps={};var be=a.a.memo(ue);function je(e){var t,n,a,c=Object(s.a)().t,l=Object(o.useState)({}),d=Object(r.a)(l,2),u=d[0],b=d[1],j=Object(o.useState)(!0),f=Object(r.a)(j,1)[0],O=Object(o.useState)((function(){return!!e.job.downloadDataset&&e.job.downloadDataset})),p=Object(r.a)(O,2),m=p[0],x=p[1],k=Object(o.useState)(!1),S=Object(r.a)(k,2),N=S[0],D=S[1],T=null===(t=e.job)||void 0===t||null===(n=t.transform)||void 0===n||null===(a=n.metadati)||void 0===a?void 0:a.urlFile;function z(){return(z=Object(_.a)(Y.a.mark((function e(){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:D(!0);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(o.useEffect)((function(){e.job&&e.job.transform&&Object(_.a)(Y.a.mark((function t(){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b({loading:!0}),D(!1),t.next=4,v.a.urlExistenceCheck({url:T}).then((function(t){if(t instanceof Error)return H.b.error(Object(M.f)(t)),b({loading:!1,error:Object(M.f)(t)});e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{datasetIsPublished:t.data})),b({loading:!1,success:!0}),x(t.data)}),(function(t){return H.b.error(Object(M.f)(t)),e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{outcome:t.response.data.message})),b({error:Object(M.f)(t)})}));case 4:case"end":return t.stop()}}),t)})))()}),[e.job.transform,e.job.outcome,N]);var J=void 0===u.loading||u.loading?"\ud83d\udfe1":e.job.datasetIsPublished?"\ud83d\udfe2 ".concat(c("Dataset is correctly published at address {{publishUrlFile}}",{publishUrlFile:T})):"\ud83d\udd34 ".concat(c("Dataset is not published yet at address {{publishUrlFile}}",{publishUrlFile:T}));return Object(g.jsxs)(w,{children:[Object(g.jsxs)(C,{children:[Object(g.jsx)(I,{children:c("Publish downloaded dataset")}),Object(g.jsx)("br",{}),Object(g.jsx)(y,{children:J}),Object(g.jsx)(y,{children:!e.job.datasetIsPublished&&Object(g.jsxs)("span",{children:[Object(g.jsxs)("p",{children:[c("Please provide to publish downloaded dataset"),"."]}),Object(g.jsx)("p",{children:Object(g.jsxs)(h.a,{onClick:function(){return z.apply(this,arguments)},variant:"contained",color:"tertiary",children:[c("Verify publication now")," \ud83c\udf0d"]})})]})}),Object(g.jsxs)("pre",{children:["job: ",JSON.stringify(e.job,null,2)]})]}),Object(g.jsxs)(A.a,{container:!0,children:[Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(E,{onPrev:function(){e.goto("prev")},prevIsEnabled:f,children:c("Back")})}),Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(P,{onNext:function(){e.goto("next")},nextIsEnabled:m,children:c("Continue")})})]})]})}je.defaultProps={};var fe=a.a.memo(je);function Oe(e){var t,n,a,c,l=Object(s.a)().t,d=Object(o.useState)({}),u=Object(r.a)(d,2),b=u[0],j=u[1],f=Object(o.useState)(!1),O=Object(r.a)(f,2),p=O[0],m=O[1],h=Object(o.useState)(!0),x=Object(r.a)(h,1)[0];Object(o.useEffect)((function(){e.job&&e.job.transform&&(e.job.outcome?(m(!0),j({success:"successo"===e.job.outcome.esitoUltimoTentativoAccessoUrl})):Object(_.a)(Y.a.mark((function t(){var n,o,a,c,r,l;return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j({loading:!0}),t.next=3,v.a.outcomeCheck(null===(n=e.job)||void 0===n||null===(o=n.transform)||void 0===o||null===(a=o.metadati)||void 0===a?void 0:a.annoRiferimento,null===(c=e.job)||void 0===c||null===(r=c.transform)||void 0===r||null===(l=r.header)||void 0===l?void 0:l.codiceFiscaleStrutturaProponente).then((function(t){if(t instanceof Error)return H.b.error(Object(M.f)(t)),j({error:Object(M.f)(t)});e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{outcome:t.data})),j({success:t.data}),m(!0)}),(function(t){return H.b.error(Object(M.f)(t)),e.setJob(Object(i.a)(Object(i.a)({},e.job),{},{outcome:t.response.data.message})),j({error:Object(M.f)(t)})}));case 3:case"end":return t.stop()}}),t)})))())}),[e.job.transform,e.job.outcome]);return Object(g.jsxs)(w,{children:[Object(g.jsxs)(C,{children:[Object(g.jsx)(I,{children:l("Wait for ANAC validation")}),Object(g.jsxs)(y,{children:[b&&"success"in b&&"successo"===(null===(t=e.job)||void 0===t||null===(n=t.outcome)||void 0===n?void 0:n.esitoUltimoTentativoAccessoUrl)&&Object(g.jsxs)("pre",{children:[Object(g.jsx)("span",{style:{color:"green",fontSize:"1.7em"},children:"\u2713"})," ",null===(a=e.job)||void 0===a||null===(c=a.outcome)||void 0===c?void 0:c.dataUltimoTentativoAccessoUrl]}),Object(g.jsxs)("pre",{children:["JOB: ",JSON.stringify(e.job,null,2)]})]}),b&&"error"in b&&"Errore: ".concat(b.error)]}),Object(g.jsxs)(A.a,{container:!0,children:[Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(E,{onPrev:function(){e.goto("prev")},prevIsEnabled:x,children:l("Back")})}),Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(P,{onNext:function(){e.goto("next")},nextIsEnabled:p,children:l("Continue")})})]})]})}Oe.defaultProps={};var pe=a.a.memo(Oe);function me(e){var t=Object(s.a)().t,n=Object(o.useState)(!0),a=Object(r.a)(n,1)[0];return Object(g.jsxs)(w,{children:[Object(g.jsxs)(C,{children:[Object(g.jsxs)(I,{children:[t("Finished"),"!"]}),Object(g.jsx)(y,{children:Object(g.jsx)("div",{style:{fontSize:128,textAlign:"center"},children:"\ud83c\udfc1"})})]}),Object(g.jsx)(A.a,{container:!0,children:Object(g.jsx)(A.a,{item:!0,xs:6,children:Object(g.jsx)(E,{onPrev:function(){e.goto("prev")},prevIsEnabled:a,children:t("Back")})})})]})}me.defaultProps={};var ve=a.a.memo(me),he=["children","value","index"];function xe(e){var t=e.children,n=e.value,o=e.index,a=Object(l.a)(e,he);return Object(g.jsx)(O.a,Object(i.a)(Object(i.a)({component:"div",role:"tabpanel",hidden:n!==o,id:"scrollable-auto-tabpanel-".concat(o),"aria-labelledby":"nav-tab-".concat(o)},a),{},{children:Object(g.jsx)(p.a,{p:3,children:t})}))}var ge=function(e){return{id:"nav-tab-".concat(e),"aria-controls":"nav-tabpanel-".concat(e)}},ke=Object(d.a)((function(e){return{root:{opacity:.8}}}))((function(e){return Object(g.jsx)(f.a,Object(i.a)({},e))})),we=Object(c.a)((function(e){return{root:{flexGrow:1},tab:{backgroundColor:e.palette.secondary.light},tabIndicator:{backgroundColor:"MediumSeaGreen",height:3}}})),Ce=function(){var e=we(),t=Object(o.useState)((function(){return m.a.getJob()})),n=Object(r.a)(t,2),a=n[0],c=n[1],l=Object(s.a)().t;function d(e){c(Object(i.a)(Object(i.a)({},a),{},{tabId:e}))}function f(e){var t=e;if("string"===typeof e)switch(e.toLowerCase()){case"start":case"download template":case"fill your data":case"upload":case"check":case"download dataset":case"publish":case"wait for validation":case"finish!":break;case"next":t=a?a.tabId+1:0;break;case"prev":t=a?a.tabId-1:0;break;default:return void console.error("Unforeseen where specification in goto: ".concat(e))}d(t)}return Object(o.useEffect)((function(){var e=m.a.get("redirect");e&&(c(Object(i.a)(Object(i.a)({},a),{},{tabId:e})),m.a.remove("redirect"))}),[a]),Object(o.useEffect)((function(){m.a.setJob(a),v.a.set(a)}),[a]),null!==a&&void 0!==a&&a.tabId||(a.tabId=0),Object(g.jsxs)("div",{className:e.root,children:[Object(g.jsx)(u.a,{elevation:0,position:"fixed",style:{top:50},children:Object(g.jsx)(b.a,{elevation:1,square:!0,children:Object(g.jsxs)(j.a,{value:null===a||void 0===a?void 0:a.tabId,variant:"scrollable",scrollButtons:"auto",onChange:function(e,t){R.a.ui.userCanForceTabChange&&d(t)},"aria-label":"current section",classes:{indicator:e.tabIndicator},className:e.tab,children:[Object(g.jsx)(ke,Object(i.a)({label:"".concat(l("Start")," \ud83e\ude84")},ge(0))),Object(g.jsx)(ke,Object(i.a)({label:"".concat(l("Download template")," \u25bc")},ge(1))),Object(g.jsx)(ke,Object(i.a)({label:"".concat(l("Fill your data")," \ud83d\udd8b")},ge(2))),Object(g.jsx)(ke,Object(i.a)({label:"".concat(l("Upload")," \u25b2")},ge(3))),Object(g.jsx)(ke,Object(i.a)({label:"".concat(l("Check")," \u2705")},ge(4))),Object(g.jsx)(ke,Object(i.a)({label:"".concat(l("Download dataset")," \u2935")},ge(5))),Object(g.jsx)(ke,Object(i.a)({label:"".concat(l("Publish")," \ud83c\udf0d")},ge(6))),Object(g.jsx)(ke,Object(i.a)({label:"".concat(l("Wait for validation")," \ud83c\udfaf")},ge(7))),Object(g.jsx)(ke,Object(i.a)({label:"".concat(l("Finish!")," \ud83c\udfc1")},ge(8)))]})})}),Object(g.jsxs)(g.Fragment,{children:[0===(null===a||void 0===a?void 0:a.tabId)&&Object(g.jsx)(xe,{index:0,value:a.tabId,children:Object(g.jsx)(D,{goto:f,job:a,setJob:function(e){return c(e)}})}),1===(null===a||void 0===a?void 0:a.tabId)&&Object(g.jsx)(xe,{index:1,value:a.tabId,children:Object(g.jsx)(X,{goto:f,job:a,setJob:function(e){return c(e)}})}),2===(null===a||void 0===a?void 0:a.tabId)&&Object(g.jsx)(xe,{index:2,value:a.tabId,children:Object(g.jsx)(G,{goto:f,job:a,setJob:function(e){return c(e)}})}),3===(null===a||void 0===a?void 0:a.tabId)&&Object(g.jsx)(xe,{index:3,value:a.tabId,children:Object(g.jsx)(ne,{goto:f,job:a,setJob:function(e){return c(e)}})}),4===(null===a||void 0===a?void 0:a.tabId)&&Object(g.jsx)(xe,{index:4,value:a.tabId,children:Object(g.jsx)(de,{goto:f,job:a,setJob:function(e){return c(e)}})}),5===(null===a||void 0===a?void 0:a.tabId)&&Object(g.jsx)(xe,{index:5,value:a.tabId,children:Object(g.jsx)(be,{goto:f,job:a,setJob:function(e){return c(e)}})}),6===(null===a||void 0===a?void 0:a.tabId)&&Object(g.jsx)(xe,{index:6,value:a.tabId,children:Object(g.jsx)(fe,{goto:f,job:a,setJob:function(e){return c(e)}})}),7===(null===a||void 0===a?void 0:a.tabId)&&Object(g.jsx)(xe,{index:7,value:a.tabId,children:Object(g.jsx)(pe,{goto:f,job:a,setJob:function(e){return c(e)}})}),8===(null===a||void 0===a?void 0:a.tabId)&&Object(g.jsx)(xe,{index:8,value:a.tabId,children:Object(g.jsx)(ve,{goto:f,job:a,setJob:function(e){return c(e)}})})]})]})},Ie=Object(c.a)((function(e){return{home:{fontSize:"1.5em"}}}));function ye(){var e=Ie();return Object(g.jsx)("div",{className:e.home,children:Object(g.jsx)(Ce,{})})}t.default=a.a.memo(ye)}}]);
//# sourceMappingURL=15.e163417f.chunk.js.map