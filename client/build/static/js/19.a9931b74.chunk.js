(this["webpackJsonpappalti190-client"]=this["webpackJsonpappalti190-client"]||[]).push([[19],{327:function(e,t,r){"use strict";var n=r(31),a={getProfile:function(){return n.a.get("/user/getProfile").then((function(e){return e.data}),(function(e){return e}))},updateProfile:function(e){var t=e.email,r=e.password,a=e.firstName,o=e.lastName,i=e.address,s=e.fiscalCode,l=e.businessName;return n.a.post("/user/updateProfile",{email:t,password:r,firstName:a,lastName:o,address:i,fiscalCode:s,businessName:l}).then((function(e){return e.data}),(function(e){return e}))},updateUserProperty:function(e){var t=e.userId,r=e.propertyName,a=e.propertyValue;return n.a.post("/user/updateUserProperty",{userId:t,propertyName:r,propertyValue:a}).then((function(e){return e.data}),(function(e){return e}))},getPlans:function(e){return n.a.get("/user/getPlans").then((function(e){return e.data}),(function(e){return e}))},updatePlan:function(e){return console.log("updatePlan - plan:",e),n.a.post("/user/updatePlan",e).then((function(e){return e.data}),(function(e){return e}))},getRoles:function(e){return n.a.get("/user/getRoles").then((function(e){return e.data}),(function(e){return e}))},updateRoles:function(e){return n.a.post("/user/updateRoles",e).then((function(e){return e.data}),(function(e){return e}))},getPublicContent:function(){return n.a.get("/test/all")},getUserBoard:function(){return n.a.get("/test/user")},getModeratorBoard:function(){return n.a.get("/test/mod")},getAdminBoard:function(){return n.a.get("/test/admin")},getAdminPanel:function(){return n.a.get("/admin/getAdminPanel").then((function(e){return e.data}),(function(e){return e}))}};t.a=a},454:function(e,t,r){"use strict";r.r(t);var n=r(105),a=r(14),o=r(21),i=r(313),s=r(88),l=r.n(s),c=r(0),d=r.n(c),u=r(18),f=r(296),b=r(339),p=r(287),m=r(299),j=r(303),h=r(463),g=r(474),O=r(298),x=r(420),P=r(292),C=r(302),N=r(368),v=r(457),y=r(301),S=r(476),w=r(455),E=r(456),R=r(481),k=r(460),D=r(136),W=r.n(D),G=r(415),M=r.n(G),A=r(324),U=r.n(A),V=r(40),z=r(76),L=r(327),F=r(45),I=r(57),B=r(77),T=r(1),H=["children","value","index"],J=Object(p.a)((function(e){return function(e){return{root:{flexGrow:1},datagrid:{"&.MuiDataGrid-root .MuiDataGrid-columnHeader:focus, &.MuiDataGrid-root .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-cell:focus-within, & .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-columnHeaderCheckbox:focus-within, & .MuiDataGrid-columnHeaderCheckbox:focus":{outline:"none"},"& .adminpanel-table--row":{borderRadius:1,backgroundColor:e.palette.tertiary.light,outline:"none"}},avatar:{backgroundColor:e.palette.success.main},columnLeft:{marginLeft:e.spacing(.2)},columnRight:{marginLeft:"auto",marginRight:e.spacing(.2)},form:{},fieldset:{border:0},fieldsetPersonalData:{color:"#758c75",fontSize:13,border:1,borderStyle:"solid",borderColor:"#758c75",borderRadius:5},fieldsetCompanyData:{color:"#7a7aa5",fontSize:13,border:1,borderStyle:"solid",borderColor:"#7a7aa5",borderRadius:5},fieldsetAddress:{color:"#aaa",fontSize:13,border:1,borderStyle:"solid",borderColor:"#aaa",borderRadius:5},title:{width:"100%",color:e.palette.title.color,display:"flex",justifyContent:"center",paddingTop:3,paddingBottom:50,paddingLeft:10,paddingRight:10},formControlSelectPlan:{minWidth:200},formControlSelectRole:{minWidth:200},tab:{backgroundColor:e.palette.secondary.light},tabIndicator:{backgroundColor:e.palette.secondary.dark,height:1}}}(e)}));function q(e){var t=e.children,r=e.value,n=e.index,a=Object(i.a)(e,H);return Object(T.jsx)(O.a,Object(o.a)(Object(o.a)({component:"div",role:"tabpanel",hidden:r!==n,id:"scrollable-auto-tabpanel-".concat(n),"aria-labelledby":"nav-tab-".concat(n)},a),{},{children:Object(T.jsx)(N.a,{p:3,children:t})}))}function Z(e){var t,r=J(),i=Object(u.f)(),s=Object(c.useState)(F.a.getUser()),d=Object(a.a)(s,1)[0],p=Object(c.useState)([]),O=Object(a.a)(p,2),D=O[0],G=O[1],A=Object(c.useState)(!1),H=Object(a.a)(A,2),Z=H[0],_=H[1],K=Object(c.useState)(10),Q=Object(a.a)(K,2),X=Q[0],Y=Q[1],$=Object(c.useState)([5,10,20,50,100]),ee=Object(a.a)($,1)[0],te=Object(c.useState)(0),re=Object(a.a)(te,2),ne=re[0],ae=re[1],oe=Object(c.useState)(!1),ie=Object(a.a)(oe,2)[1],se=Object(f.a)().t,le=Object(c.useState)(e.tabValue),ce=Object(a.a)(le,2),de=ce[0],ue=ce[1],fe=Object(c.useState)(!1),be=Object(a.a)(fe,1)[0],pe=Object(c.useState)(Object(I.a)(V.a)),me=Object(a.a)(pe,1)[0],je=Object(c.useState)((function(){switch(me){case"it":return w.a.components.MuiDataGrid.defaultProps.localeText;case"fr":return E.a.components.MuiDataGrid.defaultProps.localeText;default:return null}})),he=Object(a.a)(je,1)[0],ge=[{field:"actions",headerName:se("Actions"),type:"actions",width:90,getActions:function(e){return[Object(T.jsx)(R.a,{label:se("Delete"),icon:Object(T.jsx)(M.a,{}),onClick:function(e){console.log("DELETE",e)}}),Object(T.jsx)(R.a,{label:se("Force logout"),icon:Object(T.jsx)(U.a,{}),onClick:function(e){console.log("FORCE LOGOUT",e)}})]}},{field:"firstName",headerName:se("First Name"),minWidth:100,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("firstName",e)}},{field:"lastName",headerName:se("Last Name"),minWidth:120,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("lastName",e)}},{field:"email",headerName:se("Email"),minWidth:240,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("email",e)}},{field:"businessName",headerName:se("Business name"),minWidth:150,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("businessName",e)}},{field:"fiscalCode",headerName:se("Fiscal code"),minWidth:180,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("fiscalCode",e)}},{field:"roles",headerName:se("Role"),minWidth:170,flex:1,editable:!0,type:"singleSelect",valueOptions:["user","admin"]},{field:"plan",headerName:se("Plan"),minWidth:150,flex:1,editable:!0,type:"singleSelect",valueOptions:[se("free"),se("standard"),se("unlimited")]},{field:"addressStreet",headerName:se("Street"),minWidth:180,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("addressStreet",e)}},{field:"address.streetNo",headerName:se("N\xb0"),minWidth:50,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("address.streetNo",e)},renderCell:function(e){return e.row["address.streetNo"]}},{field:"address.city",headerName:se("City"),minWidth:90,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("address.city",e)},renderCell:function(e){return e.row["address.city"]}},{field:"address.zip",headerName:se("ZIP"),minWidth:70,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("address.zip",e)},renderCell:function(e){return e.row["address.zip"]}},{field:"address.province",headerName:se("Pr."),minWidth:50,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("address.province",e)},renderCell:function(e){return e.row["address.province"]}},{field:"address.country",headerName:se("Country"),minWidth:80,flex:1,editable:!0,preProcessEditCellProps:function(e){return Oe("address.country",e)},renderCell:function(e){return e.row["address.country"]}}],Oe=function(){var e=Object(n.a)(l.a.mark((function e(t,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("*** preProcessEditCellValidation property, params:",t,r),e.abrupt("return",new Promise((function(e,n){return L.a.updateUserProperty({userId:r.id,propertyName:t,propertyValue:r.props.value}).then((function(t){t instanceof Error?(B.b.dismiss(),B.b.warn(Object(z.g)(t)),n(Object(o.a)(Object(o.a)({},r.props),{},{error:!0}))):(console.log("*** preProcessEditCellValidation result:",t),r.props.value=t.propertyValue,e(Object(o.a)(Object(o.a)({},r.props),{},{error:!1})))}))})));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){null!==d&&void 0!==d&&d.id||(B.b.error(se("User must be authenticated")),i.goBack())}),[null===d||void 0===d?void 0:d.id,i,se]),Object(b.a)((function(e){be&&e.preventDefault()})),Object(c.useEffect)((function(){var e=i.block((function(e,t){return!be||window.confirm(se("Are you sure to ignore unsaved data?"))}));return function(){e()}}),[be,i,se]),Object(c.useEffect)((function(){L.a.getAdminPanel().then((function(e){if(e instanceof Error)return console.error("getAdminPanel error:",e),ie({code:e.message});console.log("getAdminPanel got successfully:",e.users),e.users=e.users.map((function(e){return Object(o.a)(Object(o.a)({},Object(z.h)(e,"address")),{},{id:e._id,plan:e.plan.name,roles:e.roles[0].name})})),console.log("getAdminPanel got successfully after flattening:",e.users),G(e.users),_(!0)}))}),[null===d||void 0===d?void 0:d.id,ie,se]),console.log("USERS:",D),Object(T.jsx)("div",{className:r.root,children:Object(T.jsxs)(C.a,{children:[" ",Object(T.jsx)(N.a,{m:1}),Object(T.jsx)(P.a,{container:!0,justifyContent:"center",children:Object(T.jsx)(x.a,{className:r.avatar,children:Object(T.jsx)(W.a,{})})}),Object(T.jsx)(N.a,{m:3}),Object(T.jsx)(m.a,{elevation:0,position:"static",children:Object(T.jsx)(j.a,{elevation:1,square:!0,children:Object(T.jsx)(h.a,{value:de,onChange:function(e,t){ue(t)},variant:"standard","aria-label":"tabs administrator's panel",classes:{indicator:r.tabIndicator},className:r.tab,children:Object(T.jsx)(g.a,Object(o.a)({label:se("Users")},(t=0,{id:"simple-tab-".concat(t),"aria-controls":"simple-tabpanel-".concat(t)})))})})}),Object(T.jsxs)(q,{value:de,index:0,children:[Object(T.jsx)(N.a,{m:3}),Object(T.jsx)(k.a,{rows:D,columns:ge,localeText:he,autoHeight:!0,pageSize:X,onPageSizeChange:function(e){return Y(e)},rowsPerPageOptions:ee,pagination:!0,checkboxSelection:!0,disableSelectionOnClick:!0,className:r.datagrid,getRowClassName:function(){return"adminpanel-table--row"},onCellEditCommit:function(e){B.b.success(se("Field updated"))},onSelectionChange:function(e){!function(e){console.warn(e.rows+" selected users")}(e)},onRowSelected:function(e){return console.warn(e.api.current.getSlectedRows()+" selected users")},onSelectionModelChange:function(e){var t=new Set(e);ae(D.filter((function(e){return t.has(e.id.toString())})).length)},rowHeight:40,components:{NoRowsOverlay:function(){return Object(T.jsx)(v.a,{height:"100%",alignItems:"center",justifyContent:"center",children:Z?se("No users found"):se("Loading")+"..."})}},experimentalFeatures:{preventCommitWhileValidating:!0}}),Object(T.jsx)(N.a,{m:3}),ne>0&&Object(T.jsxs)("div",{children:[Object(T.jsx)(S.a,{title:se("Delete all selected users"),placement:"top",children:Object(T.jsx)(y.a,{"aria-label":"delete all selected users",onClick:function(){return alert("delete all selected...")},children:Object(T.jsx)(M.a,{})})}),Object(T.jsx)(S.a,{title:se("Force logout for all selected users"),placement:"top",children:Object(T.jsx)(y.a,{"aria-label":"force logout for all selected users",onClick:function(){return alert("logout all selected...")},children:Object(T.jsx)(U.a,{})})})]})]})]})})}Z.defaultProps={tabValue:0},t.default=d.a.memo(Z)}}]);
//# sourceMappingURL=19.a9931b74.chunk.js.map