2023-03-21T16:45:54.671Z info: -----
2023-03-21T16:45:54.673Z info: Loading test environment

[0m[0m
[0m  API tests - Auth routes[0m
2023-03-21T16:45:56.795Z info: Successfully connected to MongoDB
  [32m  [32mâœ”[39m[0m[90m should register user[0m[31m (322ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not register user twice[0m
  [32m  [32mâœ”[39m[0m[90m should not register user with invalid email[0m
  [32m  [32mâœ”[39m[0m[90m should not register user forcing invalid plan[0m
  [32m  [32mâœ”[39m[0m[90m should not register user forcing invalid role[0m
  [32m  [32mâœ”[39m[0m[90m should not login user before confirmation[0m
  [32m  [32mâœ”[39m[0m[90m should resend signup code[0m
  [32m  [32mâœ”[39m[0m[90m should not confirm user without code[0m
  [32m  [32mâœ”[39m[0m[90m should not confirm user with invalid code[0m
2023-03-21T16:45:57.251Z info: User signup: {"roles":["6405b3152c959193b3979dfc"],"isDeleted":false,"isVerified":true,"_id":"6419df443de72a906f730908","email":"user@mail.com","password":"$2a$10$ccFFcdWVPDjf0Q.GIsGjbOQgWlpSu0Qs70m/CHgQp97g9AunT3sPi","address":{"_id":"6419df443de72a906f730909","city":""},"plan":"63fce828d86497622429a3c4","createdAt":"2023-03-21T16:45:56.925Z","updatedAt":"2023-03-21T16:45:57.244Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should confirm user[0m[33m (47ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not confirm user twice[0m
  [32m  [32mâœ”[39m[0m[90m should not resend signup code for already verified user[0m
  [32m  [32mâœ”[39m[0m[90m should not resend signup code without email[0m
  [32m  [32mâœ”[39m[0m[90m should not reset password without email[0m
  [32m  [32mâœ”[39m[0m[90m should start reset password[0m
  [32m  [32mâœ”[39m[0m[90m should confirm reset password[0m[31m (193ms)[0m
  [32m  [32mâœ”[39m[0m[90m should resend reset password code[0m
2023-03-21T16:45:57.741Z info: User signin: user@mail.com
  [32m  [32mâœ”[39m[0m[90m should login user[0m[31m (196ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not refresh token without refresh token[0m
  [32m  [32mâœ”[39m[0m[90m should refresh token[0m

[0m  API tests - Job routes[0m
2023-03-21T16:45:57.965Z info: User signup: {"roles":["6405b3152c959193b3979dfc"],"isDeleted":false,"isVerified":true,"_id":"6419df453de72a906f73093e","email":"user@mail.com","password":"$2a$10$KiVJE5BLJi0jpz7xhXnC7.fCnVnNOYnP6D5SVCUInm7nxaZuimj2y","address":{"_id":"6419df453de72a906f73093f","city":""},"plan":"63fce828d86497622429a3c4","createdAt":"2023-03-21T16:45:57.780Z","updatedAt":"2023-03-21T16:45:57.962Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register normal user[0m[31m (197ms)[0m
2023-03-21T16:45:58.187Z info: User signin: user@mail.com
  [32m  [32mâœ”[39m[0m[90m should login normal user[0m[31m (223ms)[0m
2023-03-21T16:45:58.484Z info: User signup: {"roles":["6405b3152c959193b3979dfd"],"isDeleted":false,"isVerified":true,"_id":"6419df463de72a906f730950","email":"admin@mail.com","password":"$2a$10$8uLWoxfMReJsFbfT2k/klegPSyTLz9spN0CzV5SsIz466WeGQMV.y","address":{"_id":"6419df463de72a906f730951","city":""},"plan":"63fce828d86497622429a3c6","createdAt":"2023-03-21T16:45:58.211Z","updatedAt":"2023-03-21T16:45:58.471Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register admin user[0m[31m (294ms)[0m
2023-03-21T16:45:58.704Z info: User signin: admin@mail.com
  [32m  [32mâœ”[39m[0m[90m should login as admin user[0m[31m (219ms)[0m
2023-03-21T16:45:58.938Z info: User signup: {"roles":["6405b3152c959193b3979dfd"],"isDeleted":false,"isVerified":true,"_id":"6419df463de72a906f730962","email":"admin-standard@mail.com","password":"$2a$10$PI0FZyEBmgkH4d3soPtB9uha5l7i3d8EngZR8r0O2cfERZEOcWI.6","address":{"_id":"6419df463de72a906f730963","city":""},"plan":"63fce828d86497622429a3c5","createdAt":"2023-03-21T16:45:58.728Z","updatedAt":"2023-03-21T16:45:58.935Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register admin user with standard plan[0m[31m (231ms)[0m
2023-03-21T16:45:59.141Z info: User signin: admin-standard@mail.com
  [32m  [32mâœ”[39m[0m[90m should login as admin user with standard plan[0m[31m (203ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not upload a file without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should upload a file as normal user[0m
  [32m  [32mâœ”[39m[0m[90m should not transform XLS to XML without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should not transform XLS to XML as normal user (not existing file)[0m
  [32m  [32mâœ”[39m[0m[90m should transform XLS to XML as normal user (some errors file)[0m[31m (3221ms)[0m
  [32m  [32mâœ”[39m[0m[90m should transform XLS to XML as normal user (more errors file)[0m[31m (1642ms)[0m
  [32m  [32mâœ”[39m[0m[90m should transform XLS to XML as admin user with standard plan, truncating (good file)[0m[31m (1424ms)[0m
  [32m  [32mâœ”[39m[0m[90m should transform XLS to XML as normal user (good file)[0m[31m (1223ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not validate XML without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should validate XML (one output file ok)[0m[31m (764ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not validate XML (one output file, no file)[0m
  [32m  [32mâœ”[39m[0m[90m should validate XML (index output file ok)[0m[31m (705ms)[0m

[0m  API tests - Payment routes[0m
2023-03-21T16:46:08.383Z info: User signup: {"roles":["6405b3152c959193b3979dfc"],"isDeleted":false,"isVerified":true,"_id":"6419df503de72a906f730988","email":"user@mail.com","password":"$2a$10$lTHhYNIJm8D/v90TCD0azeSSoAWllFqQ.FK.Uk0OH3XMrkHhMoJZK","address":{"_id":"6419df503de72a906f730989","city":""},"plan":"63fce828d86497622429a3c4","createdAt":"2023-03-21T16:46:08.194Z","updatedAt":"2023-03-21T16:46:08.381Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register normal user[0m[31m (202ms)[0m
2023-03-21T16:46:08.611Z info: User signin: user@mail.com
  [32m  [32mâœ”[39m[0m[90m should login normal user[0m[31m (227ms)[0m
  [32m  [32mâœ”[39m[0m[90m should get payment mode, and it should be in a set of values[0m
  [32m  [32mâœ”[39m[0m[90m should not create a checkout session without authentication[0m
2023-03-21T16:46:09.957Z error: Payment session creation error: {"type":"StripeInvalidRequestError","raw":{"message":"The Checkout Session's total amount due cannot be zero in `payment` mode. Please see https://stripe.com/docs/currencies#minimum-and-maximum-charge-amounts","request_log_url":"https://dashboard.stripe.com/test/logs/req_Cy4L213u0sjmEz?t=1679417169","type":"invalid_request_error","headers":{"server":"nginx","date":"Tue, 21 Mar 2023 16:46:09 GMT","content-type":"application/json","content-length":"327","connection":"keep-alive","access-control-allow-credentials":"true","access-control-allow-methods":"GET, POST, HEAD, OPTIONS, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","idempotency-key":"01739b9f-da71-4c66-8e24-3154bc70fa24","original-request":"req_Cy4L213u0sjmEz","request-id":"req_Cy4L213u0sjmEz","stripe-should-retry":"false","stripe-version":"2020-08-27","strict-transport-security":"max-age=63072000; includeSubDomains; preload"},"statusCode":400,"requestId":"req_Cy4L213u0sjmEz"},"rawType":"invalid_request_error","headers":{"server":"nginx","date":"Tue, 21 Mar 2023 16:46:09 GMT","content-type":"application/json","content-length":"327","connection":"keep-alive","access-control-allow-credentials":"true","access-control-allow-methods":"GET, POST, HEAD, OPTIONS, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","idempotency-key":"01739b9f-da71-4c66-8e24-3154bc70fa24","original-request":"req_Cy4L213u0sjmEz","request-id":"req_Cy4L213u0sjmEz","stripe-should-retry":"false","stripe-version":"2020-08-27","strict-transport-security":"max-age=63072000; includeSubDomains; preload"},"requestId":"req_Cy4L213u0sjmEz","statusCode":400}
  [32m  [32mâœ”[39m[0m[90m should not create a checkout session for a 0 cost product[0m[31m (1334ms)[0m
2023-03-21T16:46:10.985Z info: Payment session created
  [32m  [32mâœ”[39m[0m[90m should create a checkout session for a standard product[0m[31m (1029ms)[0m
2023-03-21T16:46:11.814Z info: Payment successful for product standard
  [32m  [32mâœ”[39m[0m[90m should redirect on a payment success call[0m[31m (830ms)[0m
2023-03-21T16:46:12.530Z info: Payment canceled for product standard
  [32m  [32mâœ”[39m[0m[90m should redirect on a payment canceled call[0m[31m (708ms)[0m

[0m  API tests - User routes[0m
2023-03-21T16:46:12.794Z info: User signup: {"roles":["6405b3152c959193b3979dfc"],"isDeleted":false,"isVerified":true,"_id":"6419df543de72a906f73099b","email":"user@mail.com","password":"$2a$10$1kwHrPooQp6xCtIkzLh0EekUJyyVKJ.RHxGc4UpFMmbPMZQZcSThy","address":{"_id":"6419df543de72a906f73099c","city":""},"plan":"63fce828d86497622429a3c4","createdAt":"2023-03-21T16:46:12.611Z","updatedAt":"2023-03-21T16:46:12.791Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register normal user[0m[31m (246ms)[0m
2023-03-21T16:46:12.997Z info: User signin: user@mail.com
  [32m  [32mâœ”[39m[0m[90m should login normal user[0m[31m (202ms)[0m
2023-03-21T16:46:13.219Z info: User signup: {"roles":["6405b3152c959193b3979dfd"],"isDeleted":false,"isVerified":true,"_id":"6419df553de72a906f7309ad","email":"admin@mail.com","password":"$2a$10$3nIzc3B.Qk/aVfzJmmUk0Oe40lmvNJvDHXDk7sgrwIT4kSbY6sTN.","address":{"_id":"6419df553de72a906f7309ae","city":""},"plan":"63fce828d86497622429a3c6","createdAt":"2023-03-21T16:46:13.011Z","updatedAt":"2023-03-21T16:46:13.217Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register admin user[0m[31m (221ms)[0m
2023-03-21T16:46:13.412Z info: User signin: admin@mail.com
  [32m  [32mâœ”[39m[0m[90m should login as admin user[0m[31m (194ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not get all users with user role[0m
  [32m  [32mâœ”[39m[0m[90m should get user's profile[0m
  [32m  [32mâœ”[39m[0m[90m should not get user's profile without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should update user's profile[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's profile without autentication[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's profile for a different not existent user - as normal user[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's profile for a different existent user - as normal user[0m
  [32m  [32mâœ”[39m[0m[90m should update user's profile for a different existent user - as admin user[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own property firstName[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own property lastName[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own property fiscalCode[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own property businessName[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own property address street[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's own roles as normal user (no roles)[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's own roles as normal user (not array roles)[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's own roles as normal user (empty array role)[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own roles as normal user (equal or down grade)[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own roles as admin user (up grade)[0m
  [32m  [32mâœ”[39m[0m[90m should not get all users with user role[0m
  [32m  [32mâœ”[39m[0m[90m should get all users with admin role[0m
  [32m  [32mâœ”[39m[0m[90m should not delete user without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should not delete user without admin privileges[0m
  [32m  [32mâœ”[39m[0m[90m should not delete user with admin privileges using invalid id[0m
  [32m  [32mâœ”[39m[0m[90m should delete user with admin privileges using id[0m
  [32m  [32mâœ”[39m[0m[90m should delete user with admin privileges using email[0m
2023-03-21T16:46:13.944Z info: User signup: {"roles":["6405b3152c959193b3979dfc"],"isDeleted":false,"isVerified":true,"_id":"6419df553de72a906f730a0d","email":"user@mail.com","password":"$2a$10$z7DyzSrnG3iyckvBWjlJkuxqAK54CofwibK8EQXYJ/a0UBZPbAUmS","address":{"_id":"6419df553de72a906f730a0e","city":""},"plan":"63fce828d86497622429a3c4","createdAt":"2023-03-21T16:46:13.750Z","updatedAt":"2023-03-21T16:46:13.941Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register normal user[0m[31m (206ms)[0m
2023-03-21T16:46:14.151Z info: User signin: user@mail.com
  [32m  [32mâœ”[39m[0m[90m should login normal user[0m[31m (205ms)[0m
2023-03-21T16:46:14.358Z info: User signup: {"roles":["6405b3152c959193b3979dfd"],"isDeleted":false,"isVerified":true,"_id":"6419df563de72a906f730a1f","email":"admin@mail.com","password":"$2a$10$05XV6SDPdBYDH/TfYzLVUen7Guxy4cM.sb6pqsXvOh8DQezjAmLcO","address":{"_id":"6419df563de72a906f730a20","city":""},"plan":"63fce828d86497622429a3c6","createdAt":"2023-03-21T16:46:14.163Z","updatedAt":"2023-03-21T16:46:14.355Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register admin user[0m[31m (207ms)[0m
2023-03-21T16:46:14.550Z info: User signin: admin@mail.com
  [32m  [32mâœ”[39m[0m[90m should login as admin user[0m[31m (192ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not remove user without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should not remove user without admin privileges[0m
  [32m  [32mâœ”[39m[0m[90m should not remove user with admin privileges using invalid id[0m
  [32m  [32mâœ”[39m[0m[90m should remove user with admin privileges using id[0m
  [32m  [32mâœ”[39m[0m[90m should remove user with admin privileges using email[0m
  [32m  [32mâœ”[39m[0m[90m should remove all users with admin privileges[0m


[92m [0m[32m 85 passing[0m[90m (18s)[0m

