2023-03-21T17:12:02.588Z info: -----
2023-03-21T17:12:02.589Z info: Loading test environment

[0m[0m
[0m  API tests - Auth routes[0m
2023-03-21T17:12:03.265Z info: Successfully connected to MongoDB
  [32m  [32mâœ”[39m[0m[90m should register user[0m[31m (305ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not register user twice[0m
  [32m  [32mâœ”[39m[0m[90m should not register user with invalid email[0m
  [32m  [32mâœ”[39m[0m[90m should not register user forcing invalid plan[0m
  [32m  [32mâœ”[39m[0m[90m should not register user forcing invalid role[0m
  [32m  [32mâœ”[39m[0m[90m should not login user before confirmation[0m
  [32m  [32mâœ”[39m[0m[90m should resend signup code[0m
  [32m  [32mâœ”[39m[0m[90m should not confirm user without code[0m
  [32m  [32mâœ”[39m[0m[90m should not confirm user with invalid code[0m
2023-03-21T17:12:03.695Z info: User signup: {"roles":["6405b3152c959193b3979dfc"],"isDeleted":false,"isVerified":true,"_id":"6419e563cec2239cddc30c65","email":"user@mail.com","password":"$2a$10$1ShTy9X/ZXUMn7Xylkrxm.kaV0n2gvm1luhNLxHIgiT41KFguxOV2","address":{"_id":"6419e563cec2239cddc30c66","city":""},"plan":"63fce828d86497622429a3c4","createdAt":"2023-03-21T17:12:03.392Z","updatedAt":"2023-03-21T17:12:03.688Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should confirm user[0m[33m (49ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not confirm user twice[0m
  [32m  [32mâœ”[39m[0m[90m should not resend signup code for already verified user[0m
  [32m  [32mâœ”[39m[0m[90m should not resend signup code without email[0m
  [32m  [32mâœ”[39m[0m[90m should not reset password without email[0m
  [32m  [32mâœ”[39m[0m[90m should start reset password[0m
  [32m  [32mâœ”[39m[0m[90m should confirm reset password[0m[31m (192ms)[0m
  [32m  [32mâœ”[39m[0m[90m should resend reset password code[0m
2023-03-21T17:12:04.176Z info: User signin: user@mail.com
  [32m  [32mâœ”[39m[0m[90m should login user[0m[31m (200ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not refresh token without refresh token[0m
  [32m  [32mâœ”[39m[0m[90m should refresh token[0m

[0m  API tests - Job routes[0m
2023-03-21T17:12:04.409Z info: User signup: {"roles":["6405b3152c959193b3979dfc"],"isDeleted":false,"isVerified":true,"_id":"6419e564cec2239cddc30c9b","email":"user@mail.com","password":"$2a$10$nq.6NQztqBc5yqsPEpfNaumDdIlgSj0h1Y0ym/2G/sfT1UZZQlYiS","address":{"_id":"6419e564cec2239cddc30c9c","city":""},"plan":"63fce828d86497622429a3c4","createdAt":"2023-03-21T17:12:04.209Z","updatedAt":"2023-03-21T17:12:04.407Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register normal user[0m[31m (212ms)[0m
2023-03-21T17:12:04.607Z info: User signin: user@mail.com
  [32m  [32mâœ”[39m[0m[90m should login normal user[0m[31m (199ms)[0m
2023-03-21T17:12:04.851Z info: User signup: {"roles":["6405b3152c959193b3979dfd"],"isDeleted":false,"isVerified":true,"_id":"6419e564cec2239cddc30cad","email":"admin@mail.com","password":"$2a$10$.ff9xfnCX2YydlX2rX6A2.kMhQ1blKQ/4K2t.LlwoWaAu0DbZw5F.","address":{"_id":"6419e564cec2239cddc30cae","city":""},"plan":"63fce828d86497622429a3c6","createdAt":"2023-03-21T17:12:04.632Z","updatedAt":"2023-03-21T17:12:04.844Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register admin user[0m[31m (241ms)[0m
2023-03-21T17:12:05.060Z info: User signin: admin@mail.com
  [32m  [32mâœ”[39m[0m[90m should login as admin user[0m[31m (210ms)[0m
2023-03-21T17:12:05.299Z info: User signup: {"roles":["6405b3152c959193b3979dfd"],"isDeleted":false,"isVerified":true,"_id":"6419e565cec2239cddc30cbf","email":"admin-standard@mail.com","password":"$2a$10$eyo6GuOkkrCAgDJKahZBROA66VN.QkYrzWCJyE8OS9K453kRD65Va","address":{"_id":"6419e565cec2239cddc30cc0","city":""},"plan":"63fce828d86497622429a3c5","createdAt":"2023-03-21T17:12:05.085Z","updatedAt":"2023-03-21T17:12:05.297Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register admin user with standard plan[0m[31m (235ms)[0m
2023-03-21T17:12:05.493Z info: User signin: admin-standard@mail.com
  [32m  [32mâœ”[39m[0m[90m should login as admin user with standard plan[0m[31m (193ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not upload a file without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should upload a file as normal user[0m
  [32m  [32mâœ”[39m[0m[90m should not transform XLS to XML without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should not transform XLS to XML as normal user (not existing file)[0m
  [32m  [32mâœ”[39m[0m[90m should transform XLS to XML as normal user (some errors file)[0m[31m (2485ms)[0m
  [32m  [32mâœ”[39m[0m[90m should transform XLS to XML as normal user (more errors file)[0m[31m (1277ms)[0m
  [32m  [32mâœ”[39m[0m[90m should transform XLS to XML as admin user with standard plan, truncating (good file)[0m[31m (1332ms)[0m
  [32m  [32mâœ”[39m[0m[90m should transform XLS to XML as normal user (good file)[0m[31m (1332ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not validate XML without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should validate XML (one output file ok)[0m[31m (670ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not validate XML (one output file, no file)[0m
  [32m  [32mâœ”[39m[0m[90m should validate XML (index output file ok)[0m[31m (695ms)[0m

[0m  API tests - Payment routes[0m
2023-03-21T17:12:13.553Z info: User signup: {"roles":["6405b3152c959193b3979dfc"],"isDeleted":false,"isVerified":true,"_id":"6419e56dcec2239cddc30ce5","email":"user@mail.com","password":"$2a$10$XzbFjSGUMutmMZNZ5r/U5eMZh7wQIBklJqyWlj67JtlQB6zHG0U7G","address":{"_id":"6419e56dcec2239cddc30ce6","city":""},"plan":"63fce828d86497622429a3c4","createdAt":"2023-03-21T17:12:13.356Z","updatedAt":"2023-03-21T17:12:13.550Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register normal user[0m[31m (212ms)[0m
2023-03-21T17:12:13.737Z info: User signin: user@mail.com
  [32m  [32mâœ”[39m[0m[90m should login normal user[0m[31m (184ms)[0m
  [32m  [32mâœ”[39m[0m[90m should get payment mode, and it should be in a set of values[0m
  [32m  [32mâœ”[39m[0m[90m should not create a checkout session without authentication[0m
2023-03-21T17:12:15.458Z error: Payment session creation error: {"type":"StripeInvalidRequestError","raw":{"message":"The Checkout Session's total amount due cannot be zero in `payment` mode. Please see https://stripe.com/docs/currencies#minimum-and-maximum-charge-amounts","request_log_url":"https://dashboard.stripe.com/test/logs/req_mXvnB4k0xbX3b0?t=1679418734","type":"invalid_request_error","headers":{"server":"nginx","date":"Tue, 21 Mar 2023 17:12:15 GMT","content-type":"application/json","content-length":"327","connection":"keep-alive","access-control-allow-credentials":"true","access-control-allow-methods":"GET, POST, HEAD, OPTIONS, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","idempotency-key":"a8fe167f-c6e9-4e71-ae75-58bbe5d01cf5","original-request":"req_mXvnB4k0xbX3b0","request-id":"req_mXvnB4k0xbX3b0","stripe-should-retry":"false","stripe-version":"2020-08-27","strict-transport-security":"max-age=63072000; includeSubDomains; preload"},"statusCode":400,"requestId":"req_mXvnB4k0xbX3b0"},"rawType":"invalid_request_error","headers":{"server":"nginx","date":"Tue, 21 Mar 2023 17:12:15 GMT","content-type":"application/json","content-length":"327","connection":"keep-alive","access-control-allow-credentials":"true","access-control-allow-methods":"GET, POST, HEAD, OPTIONS, DELETE","access-control-allow-origin":"*","access-control-expose-headers":"Request-Id, Stripe-Manage-Version, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required","access-control-max-age":"300","cache-control":"no-cache, no-store","idempotency-key":"a8fe167f-c6e9-4e71-ae75-58bbe5d01cf5","original-request":"req_mXvnB4k0xbX3b0","request-id":"req_mXvnB4k0xbX3b0","stripe-should-retry":"false","stripe-version":"2020-08-27","strict-transport-security":"max-age=63072000; includeSubDomains; preload"},"requestId":"req_mXvnB4k0xbX3b0","statusCode":400}
  [32m  [32mâœ”[39m[0m[90m should not create a checkout session for a 0 cost product[0m[31m (1706ms)[0m
2023-03-21T17:12:16.371Z info: Payment session created
  [32m  [32mâœ”[39m[0m[90m should create a checkout session for a standard product[0m[31m (915ms)[0m
2023-03-21T17:12:17.099Z info: Payment successful for product standard
  [32m  [32mâœ”[39m[0m[90m should redirect on a payment success call[0m[31m (731ms)[0m
2023-03-21T17:12:18.662Z info: Payment canceled for product standard
  [32m  [32mâœ”[39m[0m[90m should redirect on a payment canceled call[0m[31m (1557ms)[0m

[0m  API tests - User routes[0m
2023-03-21T17:12:18.930Z info: User signup: {"roles":["6405b3152c959193b3979dfc"],"isDeleted":false,"isVerified":true,"_id":"6419e572cec2239cddc30cf8","email":"user@mail.com","password":"$2a$10$GFZtluBaXr6.YY/hlYq/K.gb8UR5xtVoAtf/mZYJ0CEj6mu.4VF1i","address":{"_id":"6419e572cec2239cddc30cf9","city":""},"plan":"63fce828d86497622429a3c4","createdAt":"2023-03-21T17:12:18.729Z","updatedAt":"2023-03-21T17:12:18.928Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register normal user[0m[31m (254ms)[0m
2023-03-21T17:12:19.130Z info: User signin: user@mail.com
  [32m  [32mâœ”[39m[0m[90m should login normal user[0m[31m (200ms)[0m
2023-03-21T17:12:19.353Z info: User signup: {"roles":["6405b3152c959193b3979dfd"],"isDeleted":false,"isVerified":true,"_id":"6419e573cec2239cddc30d0a","email":"admin@mail.com","password":"$2a$10$sQBA6QJVgoQ26YTrX6H3tukbs9gWy6/KQpE3zuCdtngoCtLBBYA.W","address":{"_id":"6419e573cec2239cddc30d0b","city":""},"plan":"63fce828d86497622429a3c6","createdAt":"2023-03-21T17:12:19.147Z","updatedAt":"2023-03-21T17:12:19.348Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register admin user[0m[31m (221ms)[0m
2023-03-21T17:12:19.560Z info: User signin: admin@mail.com
  [32m  [32mâœ”[39m[0m[90m should login as admin user[0m[31m (208ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not get all users with user role[0m
  [32m  [32mâœ”[39m[0m[90m should get user's profile[0m
  [32m  [32mâœ”[39m[0m[90m should not get user's profile without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should update user's profile[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's profile without autentication[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's profile for a different not existent user - as normal user[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's profile for a different existent user - as normal user[0m
  [32m  [32mâœ”[39m[0m[90m should update user's profile for a different existent user - as admin user[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own property firstName[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own property lastName[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own property fiscalCode[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own property businessName[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own property address street[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's own roles as normal user (no roles)[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's own roles as normal user (not array roles)[0m
  [32m  [32mâœ”[39m[0m[90m should not update user's own roles as normal user (empty array role)[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own roles as normal user (equal or down grade)[0m
  [32m  [32mâœ”[39m[0m[90m should update user's own roles as admin user (up grade)[0m
  [32m  [32mâœ”[39m[0m[90m should not get all users with user role[0m
  [32m  [32mâœ”[39m[0m[90m should get all users with admin role[0m
  [32m  [32mâœ”[39m[0m[90m should not delete user without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should not delete user without admin privileges[0m
  [32m  [32mâœ”[39m[0m[90m should not delete user with admin privileges using invalid id[0m
  [32m  [32mâœ”[39m[0m[90m should delete user with admin privileges using id[0m
  [32m  [32mâœ”[39m[0m[90m should delete user with admin privileges using email[0m
2023-03-21T17:12:20.113Z info: User signup: {"roles":["6405b3152c959193b3979dfc"],"isDeleted":false,"isVerified":true,"_id":"6419e573cec2239cddc30d6a","email":"user@mail.com","password":"$2a$10$06bPyxvKegj3BLDEaLvdVeQ1VW9wZgSZKUtE9qhAE/hnhFFqrXc52","address":{"_id":"6419e573cec2239cddc30d6b","city":""},"plan":"63fce828d86497622429a3c4","createdAt":"2023-03-21T17:12:19.888Z","updatedAt":"2023-03-21T17:12:20.111Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register normal user[0m[31m (237ms)[0m
2023-03-21T17:12:20.310Z info: User signin: user@mail.com
  [32m  [32mâœ”[39m[0m[90m should login normal user[0m[31m (197ms)[0m
2023-03-21T17:12:20.507Z info: User signup: {"roles":["6405b3152c959193b3979dfd"],"isDeleted":false,"isVerified":true,"_id":"6419e574cec2239cddc30d7c","email":"admin@mail.com","password":"$2a$10$qyd6MU5iWdagKu.YdiSSaeqhi4umuFugHDERoTduR//fPAw5IEpey","address":{"_id":"6419e574cec2239cddc30d7d","city":""},"plan":"63fce828d86497622429a3c6","createdAt":"2023-03-21T17:12:20.323Z","updatedAt":"2023-03-21T17:12:20.505Z","__v":0}
  [32m  [32mâœ”[39m[0m[90m should register admin user[0m[31m (196ms)[0m
2023-03-21T17:12:20.709Z info: User signin: admin@mail.com
  [32m  [32mâœ”[39m[0m[90m should login as admin user[0m[31m (202ms)[0m
  [32m  [32mâœ”[39m[0m[90m should not remove user without authentication[0m
  [32m  [32mâœ”[39m[0m[90m should not remove user without admin privileges[0m
  [32m  [32mâœ”[39m[0m[90m should not remove user with admin privileges using invalid id[0m
  [32m  [32mâœ”[39m[0m[90m should remove user with admin privileges using id[0m
  [32m  [32mâœ”[39m[0m[90m should remove user with admin privileges using email[0m
  [32m  [32mâœ”[39m[0m[90m should remove all users with admin privileges[0m


[92m [0m[32m 85 passing[0m[90m (18s)[0m

